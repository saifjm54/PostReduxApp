{"ast":null,"code":"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : factory(global.Mock = global.Mock || {});\n})(this, function (exports) {\n  'use strict';\n\n  var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\n  /**\n   * Check if we're required to add a port number.\n   *\n   * @see https://url.spec.whatwg.org/#default-port\n   * @param {Number|String} port Port number we need to check\n   * @param {String} protocol Protocol we need to check against.\n   * @returns {Boolean} Is it a default port for the given protocol\n   * @api private\n   */\n  var requiresPort = function required(port, protocol) {\n    protocol = protocol.split(':')[0];\n    port = +port;\n    if (!port) {\n      return false;\n    }\n    switch (protocol) {\n      case 'http':\n      case 'ws':\n        return port !== 80;\n      case 'https':\n      case 'wss':\n        return port !== 443;\n      case 'ftp':\n        return port !== 21;\n      case 'gopher':\n        return port !== 70;\n      case 'file':\n        return false;\n    }\n    return port !== 0;\n  };\n  var has = Object.prototype.hasOwnProperty;\n  var undef;\n\n  /**\n   * Decode a URI encoded string.\n   *\n   * @param {String} input The URI encoded string.\n   * @returns {String|Null} The decoded string.\n   * @api private\n   */\n  function decode(input) {\n    try {\n      return decodeURIComponent(input.replace(/\\+/g, ' '));\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * Attempts to encode a given input.\n   *\n   * @param {String} input The string that needs to be encoded.\n   * @returns {String|Null} The encoded string.\n   * @api private\n   */\n  function encode(input) {\n    try {\n      return encodeURIComponent(input);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * Simple query string parser.\n   *\n   * @param {String} query The query string that needs to be parsed.\n   * @returns {Object}\n   * @api public\n   */\n  function querystring(query) {\n    var parser = /([^=?#&]+)=?([^&]*)/g,\n      result = {},\n      part;\n    while (part = parser.exec(query)) {\n      var key = decode(part[1]),\n        value = decode(part[2]);\n\n      //\n      // Prevent overriding of existing properties. This ensures that build-in\n      // methods like `toString` or __proto__ are not overriden by malicious\n      // querystrings.\n      //\n      // In the case if failed decoding, we want to omit the key/value pairs\n      // from the result.\n      //\n      if (key === null || value === null || key in result) {\n        continue;\n      }\n      result[key] = value;\n    }\n    return result;\n  }\n\n  /**\n   * Transform a query string to an object.\n   *\n   * @param {Object} obj Object that should be transformed.\n   * @param {String} prefix Optional prefix.\n   * @returns {String}\n   * @api public\n   */\n  function querystringify(obj, prefix) {\n    prefix = prefix || '';\n    var pairs = [],\n      value,\n      key;\n\n    //\n    // Optionally prefix with a '?' if needed\n    //\n    if ('string' !== typeof prefix) {\n      prefix = '?';\n    }\n    for (key in obj) {\n      if (has.call(obj, key)) {\n        value = obj[key];\n\n        //\n        // Edge cases where we actually want to encode the value to an empty\n        // string instead of the stringified value.\n        //\n        if (!value && (value === null || value === undef || isNaN(value))) {\n          value = '';\n        }\n        key = encode(key);\n        value = encode(value);\n\n        //\n        // If we failed to encode the strings, we should bail out as we don't\n        // want to add invalid strings to the query.\n        //\n        if (key === null || value === null) {\n          continue;\n        }\n        pairs.push(key + '=' + value);\n      }\n    }\n    return pairs.length ? prefix + pairs.join('&') : '';\n  }\n\n  //\n  // Expose the module.\n  //\n  var stringify = querystringify;\n  var parse = querystring;\n  var querystringify_1 = {\n    stringify: stringify,\n    parse: parse\n  };\n  var CRHTLF = /[\\n\\r\\t]/g;\n  var slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//;\n  var protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\\\/]+)?([\\S\\s]*)/i;\n  var windowsDriveLetter = /^[a-zA-Z]:/;\n  var whitespace = /^[\\x00-\\x20\\u00a0\\u1680\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]+/;\n\n  /**\n   * Trim a given string.\n   *\n   * @param {String} str String to trim.\n   * @public\n   */\n  function trimLeft(str) {\n    return (str ? str : '').toString().replace(whitespace, '');\n  }\n\n  /**\n   * These are the parse rules for the URL parser, it informs the parser\n   * about:\n   *\n   * 0. The char it Needs to parse, if it's a string it should be done using\n   *    indexOf, RegExp using exec and NaN means set as current value.\n   * 1. The property we should set when parsing this value.\n   * 2. Indication if it's backwards or forward parsing, when set as number it's\n   *    the value of extra chars that should be split off.\n   * 3. Inherit from location if non existing in the parser.\n   * 4. `toLowerCase` the resulting value.\n   */\n  var rules = [['#', 'hash'],\n  // Extract from the back.\n  ['?', 'query'],\n  // Extract from the back.\n  function sanitize(address, url) {\n    // Sanitize what is left of the address\n    return isSpecial(url.protocol) ? address.replace(/\\\\/g, '/') : address;\n  }, ['/', 'pathname'],\n  // Extract from the back.\n  ['@', 'auth', 1],\n  // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],\n  // Set left over value.\n  [/:(\\d*)$/, 'port', undefined, 1],\n  // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1] // Set left over.\n  ];\n\n  /**\n   * These properties should not be copied or inherited from. This is only needed\n   * for all non blob URL's as a blob URL does not include a hash, only the\n   * origin.\n   *\n   * @type {Object}\n   * @private\n   */\n  var ignore = {\n    hash: 1,\n    query: 1\n  };\n\n  /**\n   * The location object differs when your code is loaded through a normal page,\n   * Worker or through a worker using a blob. And with the blobble begins the\n   * trouble as the location object will contain the URL of the blob, not the\n   * location of the page where our code is loaded in. The actual origin is\n   * encoded in the `pathname` so we can thankfully generate a good \"default\"\n   * location from it so we can generate proper relative URL's again.\n   *\n   * @param {Object|String} loc Optional default location object.\n   * @returns {Object} lolcation object.\n   * @public\n   */\n  function lolcation(loc) {\n    var globalVar;\n    if (typeof window !== 'undefined') {\n      globalVar = window;\n    } else if (typeof commonjsGlobal !== 'undefined') {\n      globalVar = commonjsGlobal;\n    } else if (typeof self !== 'undefined') {\n      globalVar = self;\n    } else {\n      globalVar = {};\n    }\n    var location = globalVar.location || {};\n    loc = loc || location;\n    var finaldestination = {},\n      type = typeof loc,\n      key;\n    if ('blob:' === loc.protocol) {\n      finaldestination = new Url(unescape(loc.pathname), {});\n    } else if ('string' === type) {\n      finaldestination = new Url(loc, {});\n      for (key in ignore) {\n        delete finaldestination[key];\n      }\n    } else if ('object' === type) {\n      for (key in loc) {\n        if (key in ignore) {\n          continue;\n        }\n        finaldestination[key] = loc[key];\n      }\n      if (finaldestination.slashes === undefined) {\n        finaldestination.slashes = slashes.test(loc.href);\n      }\n    }\n    return finaldestination;\n  }\n\n  /**\n   * Check whether a protocol scheme is special.\n   *\n   * @param {String} The protocol scheme of the URL\n   * @return {Boolean} `true` if the protocol scheme is special, else `false`\n   * @private\n   */\n  function isSpecial(scheme) {\n    return scheme === 'file:' || scheme === 'ftp:' || scheme === 'http:' || scheme === 'https:' || scheme === 'ws:' || scheme === 'wss:';\n  }\n\n  /**\n   * @typedef ProtocolExtract\n   * @type Object\n   * @property {String} protocol Protocol matched in the URL, in lowercase.\n   * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n   * @property {String} rest Rest of the URL that is not part of the protocol.\n   */\n\n  /**\n   * Extract protocol information from a URL with/without double slash (\"//\").\n   *\n   * @param {String} address URL we want to extract from.\n   * @param {Object} location\n   * @return {ProtocolExtract} Extracted information.\n   * @private\n   */\n  function extractProtocol(address, location) {\n    address = trimLeft(address);\n    address = address.replace(CRHTLF, '');\n    location = location || {};\n    var match = protocolre.exec(address);\n    var protocol = match[1] ? match[1].toLowerCase() : '';\n    var forwardSlashes = !!match[2];\n    var otherSlashes = !!match[3];\n    var slashesCount = 0;\n    var rest;\n    if (forwardSlashes) {\n      if (otherSlashes) {\n        rest = match[2] + match[3] + match[4];\n        slashesCount = match[2].length + match[3].length;\n      } else {\n        rest = match[2] + match[4];\n        slashesCount = match[2].length;\n      }\n    } else {\n      if (otherSlashes) {\n        rest = match[3] + match[4];\n        slashesCount = match[3].length;\n      } else {\n        rest = match[4];\n      }\n    }\n    if (protocol === 'file:') {\n      if (slashesCount >= 2) {\n        rest = rest.slice(2);\n      }\n    } else if (isSpecial(protocol)) {\n      rest = match[4];\n    } else if (protocol) {\n      if (forwardSlashes) {\n        rest = rest.slice(2);\n      }\n    } else if (slashesCount >= 2 && isSpecial(location.protocol)) {\n      rest = match[4];\n    }\n    return {\n      protocol: protocol,\n      slashes: forwardSlashes || isSpecial(protocol),\n      slashesCount: slashesCount,\n      rest: rest\n    };\n  }\n\n  /**\n   * Resolve a relative URL pathname against a base URL pathname.\n   *\n   * @param {String} relative Pathname of the relative URL.\n   * @param {String} base Pathname of the base URL.\n   * @return {String} Resolved pathname.\n   * @private\n   */\n  function resolve(relative, base) {\n    if (relative === '') {\n      return base;\n    }\n    var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/')),\n      i = path.length,\n      last = path[i - 1],\n      unshift = false,\n      up = 0;\n    while (i--) {\n      if (path[i] === '.') {\n        path.splice(i, 1);\n      } else if (path[i] === '..') {\n        path.splice(i, 1);\n        up++;\n      } else if (up) {\n        if (i === 0) {\n          unshift = true;\n        }\n        path.splice(i, 1);\n        up--;\n      }\n    }\n    if (unshift) {\n      path.unshift('');\n    }\n    if (last === '.' || last === '..') {\n      path.push('');\n    }\n    return path.join('/');\n  }\n\n  /**\n   * The actual URL instance. Instead of returning an object we've opted-in to\n   * create an actual constructor as it's much more memory efficient and\n   * faster and it pleases my OCD.\n   *\n   * It is worth noting that we should not use `URL` as class name to prevent\n   * clashes with the global URL instance that got introduced in browsers.\n   *\n   * @constructor\n   * @param {String} address URL we want to parse.\n   * @param {Object|String} [location] Location defaults for relative paths.\n   * @param {Boolean|Function} [parser] Parser for the query string.\n   * @private\n   */\n  function Url(address, location, parser) {\n    address = trimLeft(address);\n    address = address.replace(CRHTLF, '');\n    if (!(this instanceof Url)) {\n      return new Url(address, location, parser);\n    }\n    var relative,\n      extracted,\n      parse,\n      instruction,\n      index,\n      key,\n      instructions = rules.slice(),\n      type = typeof location,\n      url = this,\n      i = 0;\n\n    //\n    // The following if statements allows this module two have compatibility with\n    // 2 different API:\n    //\n    // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n    //    where the boolean indicates that the query string should also be parsed.\n    //\n    // 2. The `URL` interface of the browser which accepts a URL, object as\n    //    arguments. The supplied object will be used as default values / fall-back\n    //    for relative paths.\n    //\n    if ('object' !== type && 'string' !== type) {\n      parser = location;\n      location = null;\n    }\n    if (parser && 'function' !== typeof parser) {\n      parser = querystringify_1.parse;\n    }\n    location = lolcation(location);\n\n    //\n    // Extract protocol information before running the instructions.\n    //\n    extracted = extractProtocol(address || '', location);\n    relative = !extracted.protocol && !extracted.slashes;\n    url.slashes = extracted.slashes || relative && location.slashes;\n    url.protocol = extracted.protocol || location.protocol || '';\n    address = extracted.rest;\n\n    //\n    // When the authority component is absent the URL starts with a path\n    // component.\n    //\n    if (extracted.protocol === 'file:' && (extracted.slashesCount !== 2 || windowsDriveLetter.test(address)) || !extracted.slashes && (extracted.protocol || extracted.slashesCount < 2 || !isSpecial(url.protocol))) {\n      instructions[3] = [/(.*)/, 'pathname'];\n    }\n    for (; i < instructions.length; i++) {\n      instruction = instructions[i];\n      if (typeof instruction === 'function') {\n        address = instruction(address, url);\n        continue;\n      }\n      parse = instruction[0];\n      key = instruction[1];\n      if (parse !== parse) {\n        url[key] = address;\n      } else if ('string' === typeof parse) {\n        index = parse === '@' ? address.lastIndexOf(parse) : address.indexOf(parse);\n        if (~index) {\n          if ('number' === typeof instruction[2]) {\n            url[key] = address.slice(0, index);\n            address = address.slice(index + instruction[2]);\n          } else {\n            url[key] = address.slice(index);\n            address = address.slice(0, index);\n          }\n        }\n      } else if (index = parse.exec(address)) {\n        url[key] = index[1];\n        address = address.slice(0, index.index);\n      }\n      url[key] = url[key] || (relative && instruction[3] ? location[key] || '' : '');\n\n      //\n      // Hostname, host and protocol should be lowercased so they can be used to\n      // create a proper `origin`.\n      //\n      if (instruction[4]) {\n        url[key] = url[key].toLowerCase();\n      }\n    }\n\n    //\n    // Also parse the supplied query string in to an object. If we're supplied\n    // with a custom parser as function use that instead of the default build-in\n    // parser.\n    //\n    if (parser) {\n      url.query = parser(url.query);\n    }\n\n    //\n    // If the URL is relative, resolve the pathname against the base URL.\n    //\n    if (relative && location.slashes && url.pathname.charAt(0) !== '/' && (url.pathname !== '' || location.pathname !== '')) {\n      url.pathname = resolve(url.pathname, location.pathname);\n    }\n\n    //\n    // Default to a / for pathname if none exists. This normalizes the URL\n    // to always have a /\n    //\n    if (url.pathname.charAt(0) !== '/' && isSpecial(url.protocol)) {\n      url.pathname = '/' + url.pathname;\n    }\n\n    //\n    // We should not add port numbers if they are already the default port number\n    // for a given protocol. As the host also contains the port number we're going\n    // override it with the hostname which contains no port number.\n    //\n    if (!requiresPort(url.port, url.protocol)) {\n      url.host = url.hostname;\n      url.port = '';\n    }\n\n    //\n    // Parse down the `auth` for the username and password.\n    //\n    url.username = url.password = '';\n    if (url.auth) {\n      index = url.auth.indexOf(':');\n      if (~index) {\n        url.username = url.auth.slice(0, index);\n        url.username = encodeURIComponent(decodeURIComponent(url.username));\n        url.password = url.auth.slice(index + 1);\n        url.password = encodeURIComponent(decodeURIComponent(url.password));\n      } else {\n        url.username = encodeURIComponent(decodeURIComponent(url.auth));\n      }\n      url.auth = url.password ? url.username + ':' + url.password : url.username;\n    }\n    url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host ? url.protocol + '//' + url.host : 'null';\n\n    //\n    // The href is just the compiled result.\n    //\n    url.href = url.toString();\n  }\n\n  /**\n   * This is convenience method for changing properties in the URL instance to\n   * insure that they all propagate correctly.\n   *\n   * @param {String} part          Property we need to adjust.\n   * @param {Mixed} value          The newly assigned value.\n   * @param {Boolean|Function} fn  When setting the query, it will be the function\n   *                               used to parse the query.\n   *                               When setting the protocol, double slash will be\n   *                               removed from the final url if it is true.\n   * @returns {URL} URL instance for chaining.\n   * @public\n   */\n  function set(part, value, fn) {\n    var url = this;\n    switch (part) {\n      case 'query':\n        if ('string' === typeof value && value.length) {\n          value = (fn || querystringify_1.parse)(value);\n        }\n        url[part] = value;\n        break;\n      case 'port':\n        url[part] = value;\n        if (!requiresPort(value, url.protocol)) {\n          url.host = url.hostname;\n          url[part] = '';\n        } else if (value) {\n          url.host = url.hostname + ':' + value;\n        }\n        break;\n      case 'hostname':\n        url[part] = value;\n        if (url.port) {\n          value += ':' + url.port;\n        }\n        url.host = value;\n        break;\n      case 'host':\n        url[part] = value;\n        if (/:\\d+$/.test(value)) {\n          value = value.split(':');\n          url.port = value.pop();\n          url.hostname = value.join(':');\n        } else {\n          url.hostname = value;\n          url.port = '';\n        }\n        break;\n      case 'protocol':\n        url.protocol = value.toLowerCase();\n        url.slashes = !fn;\n        break;\n      case 'pathname':\n      case 'hash':\n        if (value) {\n          var char = part === 'pathname' ? '/' : '#';\n          url[part] = value.charAt(0) !== char ? char + value : value;\n        } else {\n          url[part] = value;\n        }\n        break;\n      case 'username':\n      case 'password':\n        url[part] = encodeURIComponent(value);\n        break;\n      case 'auth':\n        var index = value.indexOf(':');\n        if (~index) {\n          url.username = value.slice(0, index);\n          url.username = encodeURIComponent(decodeURIComponent(url.username));\n          url.password = value.slice(index + 1);\n          url.password = encodeURIComponent(decodeURIComponent(url.password));\n        } else {\n          url.username = encodeURIComponent(decodeURIComponent(value));\n        }\n    }\n    for (var i = 0; i < rules.length; i++) {\n      var ins = rules[i];\n      if (ins[4]) {\n        url[ins[1]] = url[ins[1]].toLowerCase();\n      }\n    }\n    url.auth = url.password ? url.username + ':' + url.password : url.username;\n    url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host ? url.protocol + '//' + url.host : 'null';\n    url.href = url.toString();\n    return url;\n  }\n\n  /**\n   * Transform the properties back in to a valid and full URL string.\n   *\n   * @param {Function} stringify Optional query stringify function.\n   * @returns {String} Compiled version of the URL.\n   * @public\n   */\n  function toString(stringify) {\n    if (!stringify || 'function' !== typeof stringify) {\n      stringify = querystringify_1.stringify;\n    }\n    var query,\n      url = this,\n      host = url.host,\n      protocol = url.protocol;\n    if (protocol && protocol.charAt(protocol.length - 1) !== ':') {\n      protocol += ':';\n    }\n    var result = protocol + (url.protocol && url.slashes || isSpecial(url.protocol) ? '//' : '');\n    if (url.username) {\n      result += url.username;\n      if (url.password) {\n        result += ':' + url.password;\n      }\n      result += '@';\n    } else if (url.password) {\n      result += ':' + url.password;\n      result += '@';\n    } else if (url.protocol !== 'file:' && isSpecial(url.protocol) && !host && url.pathname !== '/') {\n      //\n      // Add back the empty userinfo, otherwise the original invalid URL\n      // might be transformed into a valid one with `url.pathname` as host.\n      //\n      result += '@';\n    }\n\n    //\n    // Trailing colon is removed from `url.host` when it is parsed. If it still\n    // ends with a colon, then add back the trailing colon that was removed. This\n    // prevents an invalid URL from being transformed into a valid one.\n    //\n    if (host[host.length - 1] === ':') {\n      host += ':';\n    }\n    result += host + url.pathname;\n    query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n    if (query) {\n      result += '?' !== query.charAt(0) ? '?' + query : query;\n    }\n    if (url.hash) {\n      result += url.hash;\n    }\n    return result;\n  }\n  Url.prototype = {\n    set: set,\n    toString: toString\n  };\n\n  //\n  // Expose the URL parser and some additional properties that might be useful for\n  // others or testing.\n  //\n  Url.extractProtocol = extractProtocol;\n  Url.location = lolcation;\n  Url.trimLeft = trimLeft;\n  Url.qs = querystringify_1;\n  var urlParse = Url;\n\n  /*\n   * This delay allows the thread to finish assigning its on* methods\n   * before invoking the delay callback. This is purely a timing hack.\n   * http://geekabyte.blogspot.com/2014/01/javascript-effect-of-setting-settimeout.html\n   *\n   * @param {callback: function} the callback which will be invoked after the timeout\n   * @parma {context: object} the context in which to invoke the function\n   */\n  function delay(callback, context) {\n    setTimeout(function (timeoutContext) {\n      return callback.call(timeoutContext);\n    }, 4, context);\n  }\n  function log(method, message) {\n    /* eslint-disable no-console */\n    if (typeof process !== 'undefined' && process.env.NODE_ENV !== 'test') {\n      console[method].call(null, message);\n    }\n    /* eslint-enable no-console */\n  }\n\n  function reject(array, callback) {\n    if (array === void 0) array = [];\n    var results = [];\n    array.forEach(function (itemInArray) {\n      if (!callback(itemInArray)) {\n        results.push(itemInArray);\n      }\n    });\n    return results;\n  }\n  function filter(array, callback) {\n    if (array === void 0) array = [];\n    var results = [];\n    array.forEach(function (itemInArray) {\n      if (callback(itemInArray)) {\n        results.push(itemInArray);\n      }\n    });\n    return results;\n  }\n\n  /*\n   * EventTarget is an interface implemented by objects that can\n   * receive events and may have listeners for them.\n   *\n   * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\n   */\n  var EventTarget = function EventTarget() {\n    this.listeners = {};\n  };\n\n  /*\n   * Ties a listener function to an event type which can later be invoked via the\n   * dispatchEvent method.\n   *\n   * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n   * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n   * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n   */\n  EventTarget.prototype.addEventListener = function addEventListener(type, listener /* , useCapture */) {\n    if (typeof listener === 'function') {\n      if (!Array.isArray(this.listeners[type])) {\n        this.listeners[type] = [];\n      }\n\n      // Only add the same function once\n      if (filter(this.listeners[type], function (item) {\n        return item === listener;\n      }).length === 0) {\n        this.listeners[type].push(listener);\n      }\n    }\n  };\n\n  /*\n   * Removes the listener so it will no longer be invoked via the dispatchEvent method.\n   *\n   * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n   * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n   * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n   */\n  EventTarget.prototype.removeEventListener = function removeEventListener(type, removingListener /* , useCapture */) {\n    var arrayOfListeners = this.listeners[type];\n    this.listeners[type] = reject(arrayOfListeners, function (listener) {\n      return listener === removingListener;\n    });\n  };\n\n  /*\n   * Invokes all listener functions that are listening to the given event.type property. Each\n   * listener will be passed the event as the first argument.\n   *\n   * @param {object} event - event object which will be passed to all listeners of the event.type property\n   */\n  EventTarget.prototype.dispatchEvent = function dispatchEvent(event) {\n    var this$1 = this;\n    var customArguments = [],\n      len = arguments.length - 1;\n    while (len-- > 0) customArguments[len] = arguments[len + 1];\n    var eventName = event.type;\n    var listeners = this.listeners[eventName];\n    if (!Array.isArray(listeners)) {\n      return false;\n    }\n    listeners.forEach(function (listener) {\n      if (customArguments.length > 0) {\n        listener.apply(this$1, customArguments);\n      } else {\n        listener.call(this$1, event);\n      }\n    });\n    return true;\n  };\n  function trimQueryPartFromURL(url) {\n    var queryIndex = url.indexOf('?');\n    return queryIndex >= 0 ? url.slice(0, queryIndex) : url;\n  }\n\n  /*\n   * The network bridge is a way for the mock websocket object to 'communicate' with\n   * all available servers. This is a singleton object so it is important that you\n   * clean up urlMap whenever you are finished.\n   */\n  var NetworkBridge = function NetworkBridge() {\n    this.urlMap = {};\n  };\n\n  /*\n   * Attaches a websocket object to the urlMap hash so that it can find the server\n   * it is connected to and the server in turn can find it.\n   *\n   * @param {object} websocket - websocket object to add to the urlMap hash\n   * @param {string} url\n   */\n  NetworkBridge.prototype.attachWebSocket = function attachWebSocket(websocket, url) {\n    var serverURL = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverURL];\n    if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) === -1) {\n      connectionLookup.websockets.push(websocket);\n      return connectionLookup.server;\n    }\n  };\n\n  /*\n   * Attaches a websocket to a room\n   */\n  NetworkBridge.prototype.addMembershipToRoom = function addMembershipToRoom(websocket, room) {\n    var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n    if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) !== -1) {\n      if (!connectionLookup.roomMemberships[room]) {\n        connectionLookup.roomMemberships[room] = [];\n      }\n      connectionLookup.roomMemberships[room].push(websocket);\n    }\n  };\n\n  /*\n   * Attaches a server object to the urlMap hash so that it can find a websockets\n   * which are connected to it and so that websockets can in turn can find it.\n   *\n   * @param {object} server - server object to add to the urlMap hash\n   * @param {string} url\n   */\n  NetworkBridge.prototype.attachServer = function attachServer(server, url) {\n    var serverUrl = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverUrl];\n    if (!connectionLookup) {\n      this.urlMap[serverUrl] = {\n        server: server,\n        websockets: [],\n        roomMemberships: {}\n      };\n      return server;\n    }\n  };\n\n  /*\n   * Finds the server which is 'running' on the given url.\n   *\n   * @param {string} url - the url to use to find which server is running on it\n   */\n  NetworkBridge.prototype.serverLookup = function serverLookup(url) {\n    var serverURL = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverURL];\n    if (connectionLookup) {\n      return connectionLookup.server;\n    }\n  };\n\n  /*\n   * Finds all websockets which is 'listening' on the given url.\n   *\n   * @param {string} url - the url to use to find all websockets which are associated with it\n   * @param {string} room - if a room is provided, will only return sockets in this room\n   * @param {class} broadcaster - socket that is broadcasting and is to be excluded from the lookup\n   */\n  NetworkBridge.prototype.websocketsLookup = function websocketsLookup(url, room, broadcaster) {\n    var serverURL = trimQueryPartFromURL(url);\n    var websockets;\n    var connectionLookup = this.urlMap[serverURL];\n    websockets = connectionLookup ? connectionLookup.websockets : [];\n    if (room) {\n      var members = connectionLookup.roomMemberships[room];\n      websockets = members || [];\n    }\n    return broadcaster ? websockets.filter(function (websocket) {\n      return websocket !== broadcaster;\n    }) : websockets;\n  };\n\n  /*\n   * Removes the entry associated with the url.\n   *\n   * @param {string} url\n   */\n  NetworkBridge.prototype.removeServer = function removeServer(url) {\n    delete this.urlMap[trimQueryPartFromURL(url)];\n  };\n\n  /*\n   * Removes the individual websocket from the map of associated websockets.\n   *\n   * @param {object} websocket - websocket object to remove from the url map\n   * @param {string} url\n   */\n  NetworkBridge.prototype.removeWebSocket = function removeWebSocket(websocket, url) {\n    var serverURL = trimQueryPartFromURL(url);\n    var connectionLookup = this.urlMap[serverURL];\n    if (connectionLookup) {\n      connectionLookup.websockets = reject(connectionLookup.websockets, function (socket) {\n        return socket === websocket;\n      });\n    }\n  };\n\n  /*\n   * Removes a websocket from a room\n   */\n  NetworkBridge.prototype.removeMembershipFromRoom = function removeMembershipFromRoom(websocket, room) {\n    var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n    var memberships = connectionLookup.roomMemberships[room];\n    if (connectionLookup && memberships !== null) {\n      connectionLookup.roomMemberships[room] = reject(memberships, function (socket) {\n        return socket === websocket;\n      });\n    }\n  };\n  var networkBridge = new NetworkBridge(); // Note: this is a singleton\n\n  /*\n   * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\n   */\n  var CLOSE_CODES = {\n    CLOSE_NORMAL: 1000,\n    CLOSE_GOING_AWAY: 1001,\n    CLOSE_PROTOCOL_ERROR: 1002,\n    CLOSE_UNSUPPORTED: 1003,\n    CLOSE_NO_STATUS: 1005,\n    CLOSE_ABNORMAL: 1006,\n    UNSUPPORTED_DATA: 1007,\n    POLICY_VIOLATION: 1008,\n    CLOSE_TOO_LARGE: 1009,\n    MISSING_EXTENSION: 1010,\n    INTERNAL_ERROR: 1011,\n    SERVICE_RESTART: 1012,\n    TRY_AGAIN_LATER: 1013,\n    TLS_HANDSHAKE: 1015\n  };\n  var ERROR_PREFIX = {\n    CONSTRUCTOR_ERROR: \"Failed to construct 'WebSocket':\",\n    CLOSE_ERROR: \"Failed to execute 'close' on 'WebSocket':\",\n    EVENT: {\n      CONSTRUCT: \"Failed to construct 'Event':\",\n      MESSAGE: \"Failed to construct 'MessageEvent':\",\n      CLOSE: \"Failed to construct 'CloseEvent':\"\n    }\n  };\n  var EventPrototype = function EventPrototype() {};\n  EventPrototype.prototype.stopPropagation = function stopPropagation() {};\n  EventPrototype.prototype.stopImmediatePropagation = function stopImmediatePropagation() {};\n\n  // if no arguments are passed then the type is set to \"undefined\" on\n  // chrome and safari.\n  EventPrototype.prototype.initEvent = function initEvent(type, bubbles, cancelable) {\n    if (type === void 0) type = 'undefined';\n    if (bubbles === void 0) bubbles = false;\n    if (cancelable === void 0) cancelable = false;\n    this.type = \"\" + type;\n    this.bubbles = Boolean(bubbles);\n    this.cancelable = Boolean(cancelable);\n  };\n  var Event = function (EventPrototype$$1) {\n    function Event(type, eventInitConfig) {\n      if (eventInitConfig === void 0) eventInitConfig = {};\n      EventPrototype$$1.call(this);\n      if (!type) {\n        throw new TypeError(ERROR_PREFIX.EVENT_ERROR + \" 1 argument required, but only 0 present.\");\n      }\n      if (typeof eventInitConfig !== 'object') {\n        throw new TypeError(ERROR_PREFIX.EVENT_ERROR + \" parameter 2 ('eventInitDict') is not an object.\");\n      }\n      var bubbles = eventInitConfig.bubbles;\n      var cancelable = eventInitConfig.cancelable;\n      this.type = \"\" + type;\n      this.timeStamp = Date.now();\n      this.target = null;\n      this.srcElement = null;\n      this.returnValue = true;\n      this.isTrusted = false;\n      this.eventPhase = 0;\n      this.defaultPrevented = false;\n      this.currentTarget = null;\n      this.cancelable = cancelable ? Boolean(cancelable) : false;\n      this.cancelBubble = false;\n      this.bubbles = bubbles ? Boolean(bubbles) : false;\n    }\n    if (EventPrototype$$1) Event.__proto__ = EventPrototype$$1;\n    Event.prototype = Object.create(EventPrototype$$1 && EventPrototype$$1.prototype);\n    Event.prototype.constructor = Event;\n    return Event;\n  }(EventPrototype);\n  var MessageEvent = function (EventPrototype$$1) {\n    function MessageEvent(type, eventInitConfig) {\n      if (eventInitConfig === void 0) eventInitConfig = {};\n      EventPrototype$$1.call(this);\n      if (!type) {\n        throw new TypeError(ERROR_PREFIX.EVENT.MESSAGE + \" 1 argument required, but only 0 present.\");\n      }\n      if (typeof eventInitConfig !== 'object') {\n        throw new TypeError(ERROR_PREFIX.EVENT.MESSAGE + \" parameter 2 ('eventInitDict') is not an object\");\n      }\n      var bubbles = eventInitConfig.bubbles;\n      var cancelable = eventInitConfig.cancelable;\n      var data = eventInitConfig.data;\n      var origin = eventInitConfig.origin;\n      var lastEventId = eventInitConfig.lastEventId;\n      var ports = eventInitConfig.ports;\n      this.type = \"\" + type;\n      this.timeStamp = Date.now();\n      this.target = null;\n      this.srcElement = null;\n      this.returnValue = true;\n      this.isTrusted = false;\n      this.eventPhase = 0;\n      this.defaultPrevented = false;\n      this.currentTarget = null;\n      this.cancelable = cancelable ? Boolean(cancelable) : false;\n      this.canncelBubble = false;\n      this.bubbles = bubbles ? Boolean(bubbles) : false;\n      this.origin = \"\" + origin;\n      this.ports = typeof ports === 'undefined' ? null : ports;\n      this.data = typeof data === 'undefined' ? null : data;\n      this.lastEventId = \"\" + (lastEventId || '');\n    }\n    if (EventPrototype$$1) MessageEvent.__proto__ = EventPrototype$$1;\n    MessageEvent.prototype = Object.create(EventPrototype$$1 && EventPrototype$$1.prototype);\n    MessageEvent.prototype.constructor = MessageEvent;\n    return MessageEvent;\n  }(EventPrototype);\n  var CloseEvent = function (EventPrototype$$1) {\n    function CloseEvent(type, eventInitConfig) {\n      if (eventInitConfig === void 0) eventInitConfig = {};\n      EventPrototype$$1.call(this);\n      if (!type) {\n        throw new TypeError(ERROR_PREFIX.EVENT.CLOSE + \" 1 argument required, but only 0 present.\");\n      }\n      if (typeof eventInitConfig !== 'object') {\n        throw new TypeError(ERROR_PREFIX.EVENT.CLOSE + \" parameter 2 ('eventInitDict') is not an object\");\n      }\n      var bubbles = eventInitConfig.bubbles;\n      var cancelable = eventInitConfig.cancelable;\n      var code = eventInitConfig.code;\n      var reason = eventInitConfig.reason;\n      var wasClean = eventInitConfig.wasClean;\n      this.type = \"\" + type;\n      this.timeStamp = Date.now();\n      this.target = null;\n      this.srcElement = null;\n      this.returnValue = true;\n      this.isTrusted = false;\n      this.eventPhase = 0;\n      this.defaultPrevented = false;\n      this.currentTarget = null;\n      this.cancelable = cancelable ? Boolean(cancelable) : false;\n      this.cancelBubble = false;\n      this.bubbles = bubbles ? Boolean(bubbles) : false;\n      this.code = typeof code === 'number' ? parseInt(code, 10) : 0;\n      this.reason = \"\" + (reason || '');\n      this.wasClean = wasClean ? Boolean(wasClean) : false;\n    }\n    if (EventPrototype$$1) CloseEvent.__proto__ = EventPrototype$$1;\n    CloseEvent.prototype = Object.create(EventPrototype$$1 && EventPrototype$$1.prototype);\n    CloseEvent.prototype.constructor = CloseEvent;\n    return CloseEvent;\n  }(EventPrototype);\n\n  /*\n   * Creates an Event object and extends it to allow full modification of\n   * its properties.\n   *\n   * @param {object} config - within config you will need to pass type and optionally target\n   */\n  function createEvent(config) {\n    var type = config.type;\n    var target = config.target;\n    var eventObject = new Event(type);\n    if (target) {\n      eventObject.target = target;\n      eventObject.srcElement = target;\n      eventObject.currentTarget = target;\n    }\n    return eventObject;\n  }\n\n  /*\n   * Creates a MessageEvent object and extends it to allow full modification of\n   * its properties.\n   *\n   * @param {object} config - within config: type, origin, data and optionally target\n   */\n  function createMessageEvent(config) {\n    var type = config.type;\n    var origin = config.origin;\n    var data = config.data;\n    var target = config.target;\n    var messageEvent = new MessageEvent(type, {\n      data: data,\n      origin: origin\n    });\n    if (target) {\n      messageEvent.target = target;\n      messageEvent.srcElement = target;\n      messageEvent.currentTarget = target;\n    }\n    return messageEvent;\n  }\n\n  /*\n   * Creates a CloseEvent object and extends it to allow full modification of\n   * its properties.\n   *\n   * @param {object} config - within config: type and optionally target, code, and reason\n   */\n  function createCloseEvent(config) {\n    var code = config.code;\n    var reason = config.reason;\n    var type = config.type;\n    var target = config.target;\n    var wasClean = config.wasClean;\n    if (!wasClean) {\n      wasClean = code === CLOSE_CODES.CLOSE_NORMAL || code === CLOSE_CODES.CLOSE_NO_STATUS;\n    }\n    var closeEvent = new CloseEvent(type, {\n      code: code,\n      reason: reason,\n      wasClean: wasClean\n    });\n    if (target) {\n      closeEvent.target = target;\n      closeEvent.srcElement = target;\n      closeEvent.currentTarget = target;\n    }\n    return closeEvent;\n  }\n  function closeWebSocketConnection(context, code, reason) {\n    context.readyState = WebSocket$1.CLOSING;\n    var server = networkBridge.serverLookup(context.url);\n    var closeEvent = createCloseEvent({\n      type: 'close',\n      target: context.target,\n      code: code,\n      reason: reason\n    });\n    delay(function () {\n      networkBridge.removeWebSocket(context, context.url);\n      context.readyState = WebSocket$1.CLOSED;\n      context.dispatchEvent(closeEvent);\n      if (server) {\n        server.dispatchEvent(closeEvent, server);\n      }\n    }, context);\n  }\n  function failWebSocketConnection(context, code, reason) {\n    context.readyState = WebSocket$1.CLOSING;\n    var server = networkBridge.serverLookup(context.url);\n    var closeEvent = createCloseEvent({\n      type: 'close',\n      target: context.target,\n      code: code,\n      reason: reason,\n      wasClean: false\n    });\n    var errorEvent = createEvent({\n      type: 'error',\n      target: context.target\n    });\n    delay(function () {\n      networkBridge.removeWebSocket(context, context.url);\n      context.readyState = WebSocket$1.CLOSED;\n      context.dispatchEvent(errorEvent);\n      context.dispatchEvent(closeEvent);\n      if (server) {\n        server.dispatchEvent(closeEvent, server);\n      }\n    }, context);\n  }\n  function normalizeSendData(data) {\n    if (Object.prototype.toString.call(data) !== '[object Blob]' && !(data instanceof ArrayBuffer)) {\n      data = String(data);\n    }\n    return data;\n  }\n  var proxies = new WeakMap();\n  function proxyFactory(target) {\n    if (proxies.has(target)) {\n      return proxies.get(target);\n    }\n    var proxy = new Proxy(target, {\n      get: function get(obj, prop) {\n        if (prop === 'close') {\n          return function close(options) {\n            if (options === void 0) options = {};\n            var code = options.code || CLOSE_CODES.CLOSE_NORMAL;\n            var reason = options.reason || '';\n            closeWebSocketConnection(proxy, code, reason);\n          };\n        }\n        if (prop === 'send') {\n          return function send(data) {\n            data = normalizeSendData(data);\n            target.dispatchEvent(createMessageEvent({\n              type: 'message',\n              data: data,\n              origin: this.url,\n              target: target\n            }));\n          };\n        }\n        var toSocketName = function (type) {\n          return type === 'message' ? \"server::\" + type : type;\n        };\n        if (prop === 'on') {\n          return function onWrapper(type, cb) {\n            target.addEventListener(toSocketName(type), cb);\n          };\n        }\n        if (prop === 'off') {\n          return function offWrapper(type, cb) {\n            target.removeEventListener(toSocketName(type), cb);\n          };\n        }\n        if (prop === 'target') {\n          return target;\n        }\n        return obj[prop];\n      }\n    });\n    proxies.set(target, proxy);\n    return proxy;\n  }\n  function lengthInUtf8Bytes(str) {\n    // Matches only the 10.. bytes that are non-initial characters in a multi-byte sequence.\n    var m = encodeURIComponent(str).match(/%[89ABab]/g);\n    return str.length + (m ? m.length : 0);\n  }\n  function urlVerification(url) {\n    var urlRecord = new urlParse(url);\n    var pathname = urlRecord.pathname;\n    var protocol = urlRecord.protocol;\n    var hash = urlRecord.hash;\n    if (!url) {\n      throw new TypeError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" 1 argument required, but only 0 present.\");\n    }\n    if (!pathname) {\n      urlRecord.pathname = '/';\n    }\n    if (protocol === '') {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The URL '\" + urlRecord.toString() + \"' is invalid.\");\n    }\n    if (protocol !== 'ws:' && protocol !== 'wss:') {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The URL's scheme must be either 'ws' or 'wss'. '\" + protocol + \"' is not allowed.\");\n    }\n    if (hash !== '') {\n      /* eslint-disable max-len */\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The URL contains a fragment identifier ('\" + hash + \"'). Fragment identifiers are not allowed in WebSocket URLs.\");\n      /* eslint-enable max-len */\n    }\n\n    return urlRecord.toString();\n  }\n  function protocolVerification(protocols) {\n    if (protocols === void 0) protocols = [];\n    if (!Array.isArray(protocols) && typeof protocols !== 'string') {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The subprotocol '\" + protocols.toString() + \"' is invalid.\");\n    }\n    if (typeof protocols === 'string') {\n      protocols = [protocols];\n    }\n    var uniq = protocols.map(function (p) {\n      return {\n        count: 1,\n        protocol: p\n      };\n    }).reduce(function (a, b) {\n      a[b.protocol] = (a[b.protocol] || 0) + b.count;\n      return a;\n    }, {});\n    var duplicates = Object.keys(uniq).filter(function (a) {\n      return uniq[a] > 1;\n    });\n    if (duplicates.length > 0) {\n      throw new SyntaxError(ERROR_PREFIX.CONSTRUCTOR_ERROR + \" The subprotocol '\" + duplicates[0] + \"' is duplicated.\");\n    }\n    return protocols;\n  }\n\n  /*\n   * The main websocket class which is designed to mimick the native WebSocket class as close\n   * as possible.\n   *\n   * https://html.spec.whatwg.org/multipage/web-sockets.html\n   */\n  var WebSocket$1 = function (EventTarget$$1) {\n    function WebSocket(url, protocols) {\n      EventTarget$$1.call(this);\n      this._onopen = null;\n      this._onmessage = null;\n      this._onerror = null;\n      this._onclose = null;\n      this.url = urlVerification(url);\n      protocols = protocolVerification(protocols);\n      this.protocol = protocols[0] || '';\n      this.binaryType = 'blob';\n      this.readyState = WebSocket.CONNECTING;\n      var client = proxyFactory(this);\n      var server = networkBridge.attachWebSocket(client, this.url);\n\n      /*\n       * This delay is needed so that we dont trigger an event before the callbacks have been\n       * setup. For example:\n       *\n       * var socket = new WebSocket('ws://localhost');\n       *\n       * If we dont have the delay then the event would be triggered right here and this is\n       * before the onopen had a chance to register itself.\n       *\n       * socket.onopen = () => { // this would never be called };\n       *\n       * and with the delay the event gets triggered here after all of the callbacks have been\n       * registered :-)\n       */\n      delay(function delayCallback() {\n        if (server) {\n          if (server.options.verifyClient && typeof server.options.verifyClient === 'function' && !server.options.verifyClient()) {\n            this.readyState = WebSocket.CLOSED;\n            log('error', \"WebSocket connection to '\" + this.url + \"' failed: HTTP Authentication failed; no valid credentials available\");\n            networkBridge.removeWebSocket(client, this.url);\n            this.dispatchEvent(createEvent({\n              type: 'error',\n              target: this\n            }));\n            this.dispatchEvent(createCloseEvent({\n              type: 'close',\n              target: this,\n              code: CLOSE_CODES.CLOSE_NORMAL\n            }));\n          } else {\n            if (server.options.selectProtocol && typeof server.options.selectProtocol === 'function') {\n              var selectedProtocol = server.options.selectProtocol(protocols);\n              var isFilled = selectedProtocol !== '';\n              var isRequested = protocols.indexOf(selectedProtocol) !== -1;\n              if (isFilled && !isRequested) {\n                this.readyState = WebSocket.CLOSED;\n                log('error', \"WebSocket connection to '\" + this.url + \"' failed: Invalid Sub-Protocol\");\n                networkBridge.removeWebSocket(client, this.url);\n                this.dispatchEvent(createEvent({\n                  type: 'error',\n                  target: this\n                }));\n                this.dispatchEvent(createCloseEvent({\n                  type: 'close',\n                  target: this,\n                  code: CLOSE_CODES.CLOSE_NORMAL\n                }));\n                return;\n              }\n              this.protocol = selectedProtocol;\n            }\n            this.readyState = WebSocket.OPEN;\n            this.dispatchEvent(createEvent({\n              type: 'open',\n              target: this\n            }));\n            server.dispatchEvent(createEvent({\n              type: 'connection'\n            }), client);\n          }\n        } else {\n          this.readyState = WebSocket.CLOSED;\n          this.dispatchEvent(createEvent({\n            type: 'error',\n            target: this\n          }));\n          this.dispatchEvent(createCloseEvent({\n            type: 'close',\n            target: this,\n            code: CLOSE_CODES.CLOSE_NORMAL\n          }));\n          log('error', \"WebSocket connection to '\" + this.url + \"' failed\");\n        }\n      }, this);\n    }\n    if (EventTarget$$1) WebSocket.__proto__ = EventTarget$$1;\n    WebSocket.prototype = Object.create(EventTarget$$1 && EventTarget$$1.prototype);\n    WebSocket.prototype.constructor = WebSocket;\n    var prototypeAccessors = {\n      onopen: {},\n      onmessage: {},\n      onclose: {},\n      onerror: {}\n    };\n    prototypeAccessors.onopen.get = function () {\n      return this._onopen;\n    };\n    prototypeAccessors.onmessage.get = function () {\n      return this._onmessage;\n    };\n    prototypeAccessors.onclose.get = function () {\n      return this._onclose;\n    };\n    prototypeAccessors.onerror.get = function () {\n      return this._onerror;\n    };\n    prototypeAccessors.onopen.set = function (listener) {\n      this.removeEventListener('open', this._onopen);\n      this._onopen = listener;\n      this.addEventListener('open', listener);\n    };\n    prototypeAccessors.onmessage.set = function (listener) {\n      this.removeEventListener('message', this._onmessage);\n      this._onmessage = listener;\n      this.addEventListener('message', listener);\n    };\n    prototypeAccessors.onclose.set = function (listener) {\n      this.removeEventListener('close', this._onclose);\n      this._onclose = listener;\n      this.addEventListener('close', listener);\n    };\n    prototypeAccessors.onerror.set = function (listener) {\n      this.removeEventListener('error', this._onerror);\n      this._onerror = listener;\n      this.addEventListener('error', listener);\n    };\n    WebSocket.prototype.send = function send(data) {\n      var this$1 = this;\n      if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n        throw new Error('WebSocket is already in CLOSING or CLOSED state');\n      }\n\n      // TODO: handle bufferedAmount\n\n      var messageEvent = createMessageEvent({\n        type: 'server::message',\n        origin: this.url,\n        data: normalizeSendData(data)\n      });\n      var server = networkBridge.serverLookup(this.url);\n      if (server) {\n        delay(function () {\n          this$1.dispatchEvent(messageEvent, data);\n        }, server);\n      }\n    };\n    WebSocket.prototype.close = function close(code, reason) {\n      if (code !== undefined) {\n        if (typeof code !== 'number' || code !== 1000 && (code < 3000 || code > 4999)) {\n          throw new TypeError(ERROR_PREFIX.CLOSE_ERROR + \" The code must be either 1000, or between 3000 and 4999. \" + code + \" is neither.\");\n        }\n      }\n      if (reason !== undefined) {\n        var length = lengthInUtf8Bytes(reason);\n        if (length > 123) {\n          throw new SyntaxError(ERROR_PREFIX.CLOSE_ERROR + \" The message must not be greater than 123 bytes.\");\n        }\n      }\n      if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n        return;\n      }\n      var client = proxyFactory(this);\n      if (this.readyState === WebSocket.CONNECTING) {\n        failWebSocketConnection(client, code || CLOSE_CODES.CLOSE_ABNORMAL, reason);\n      } else {\n        closeWebSocketConnection(client, code || CLOSE_CODES.CLOSE_NO_STATUS, reason);\n      }\n    };\n    Object.defineProperties(WebSocket.prototype, prototypeAccessors);\n    return WebSocket;\n  }(EventTarget);\n  WebSocket$1.CONNECTING = 0;\n  WebSocket$1.prototype.CONNECTING = WebSocket$1.CONNECTING;\n  WebSocket$1.OPEN = 1;\n  WebSocket$1.prototype.OPEN = WebSocket$1.OPEN;\n  WebSocket$1.CLOSING = 2;\n  WebSocket$1.prototype.CLOSING = WebSocket$1.CLOSING;\n  WebSocket$1.CLOSED = 3;\n  WebSocket$1.prototype.CLOSED = WebSocket$1.CLOSED;\n\n  /*\n   * The socket-io class is designed to mimick the real API as closely as possible.\n   *\n   * http://socket.io/docs/\n   */\n  var SocketIO$1 = function (EventTarget$$1) {\n    function SocketIO(url, protocol) {\n      var this$1 = this;\n      if (url === void 0) url = 'socket.io';\n      if (protocol === void 0) protocol = '';\n      EventTarget$$1.call(this);\n      this.binaryType = 'blob';\n      var urlRecord = new urlParse(url);\n      if (!urlRecord.pathname) {\n        urlRecord.pathname = '/';\n      }\n      this.url = urlRecord.toString();\n      this.readyState = SocketIO.CONNECTING;\n      this.protocol = '';\n      this.target = this;\n      if (typeof protocol === 'string' || typeof protocol === 'object' && protocol !== null) {\n        this.protocol = protocol;\n      } else if (Array.isArray(protocol) && protocol.length > 0) {\n        this.protocol = protocol[0];\n      }\n      var server = networkBridge.attachWebSocket(this, this.url);\n\n      /*\n       * Delay triggering the connection events so they can be defined in time.\n       */\n      delay(function delayCallback() {\n        if (server) {\n          this.readyState = SocketIO.OPEN;\n          server.dispatchEvent(createEvent({\n            type: 'connection'\n          }), server, this);\n          server.dispatchEvent(createEvent({\n            type: 'connect'\n          }), server, this); // alias\n          this.dispatchEvent(createEvent({\n            type: 'connect',\n            target: this\n          }));\n        } else {\n          this.readyState = SocketIO.CLOSED;\n          this.dispatchEvent(createEvent({\n            type: 'error',\n            target: this\n          }));\n          this.dispatchEvent(createCloseEvent({\n            type: 'close',\n            target: this,\n            code: CLOSE_CODES.CLOSE_NORMAL\n          }));\n          log('error', \"Socket.io connection to '\" + this.url + \"' failed\");\n        }\n      }, this);\n\n      /**\n        Add an aliased event listener for close / disconnect\n       */\n      this.addEventListener('close', function (event) {\n        this$1.dispatchEvent(createCloseEvent({\n          type: 'disconnect',\n          target: event.target,\n          code: event.code\n        }));\n      });\n    }\n    if (EventTarget$$1) SocketIO.__proto__ = EventTarget$$1;\n    SocketIO.prototype = Object.create(EventTarget$$1 && EventTarget$$1.prototype);\n    SocketIO.prototype.constructor = SocketIO;\n    var prototypeAccessors = {\n      broadcast: {}\n    };\n\n    /*\n     * Closes the SocketIO connection or connection attempt, if any.\n     * If the connection is already CLOSED, this method does nothing.\n     */\n    SocketIO.prototype.close = function close() {\n      if (this.readyState !== SocketIO.OPEN) {\n        return undefined;\n      }\n      var server = networkBridge.serverLookup(this.url);\n      networkBridge.removeWebSocket(this, this.url);\n      this.readyState = SocketIO.CLOSED;\n      this.dispatchEvent(createCloseEvent({\n        type: 'close',\n        target: this,\n        code: CLOSE_CODES.CLOSE_NORMAL\n      }));\n      if (server) {\n        server.dispatchEvent(createCloseEvent({\n          type: 'disconnect',\n          target: this,\n          code: CLOSE_CODES.CLOSE_NORMAL\n        }), server);\n      }\n      return this;\n    };\n\n    /*\n     * Alias for Socket#close\n     *\n     * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L383\n     */\n    SocketIO.prototype.disconnect = function disconnect() {\n      return this.close();\n    };\n\n    /*\n     * Submits an event to the server with a payload\n     */\n    SocketIO.prototype.emit = function emit(event) {\n      var data = [],\n        len = arguments.length - 1;\n      while (len-- > 0) data[len] = arguments[len + 1];\n      if (this.readyState !== SocketIO.OPEN) {\n        throw new Error('SocketIO is already in CLOSING or CLOSED state');\n      }\n      var messageEvent = createMessageEvent({\n        type: event,\n        origin: this.url,\n        data: data\n      });\n      var server = networkBridge.serverLookup(this.url);\n      if (server) {\n        server.dispatchEvent.apply(server, [messageEvent].concat(data));\n      }\n      return this;\n    };\n\n    /*\n     * Submits a 'message' event to the server.\n     *\n     * Should behave exactly like WebSocket#send\n     *\n     * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L113\n     */\n    SocketIO.prototype.send = function send(data) {\n      this.emit('message', data);\n      return this;\n    };\n\n    /*\n     * For broadcasting events to other connected sockets.\n     *\n     * e.g. socket.broadcast.emit('hi!');\n     * e.g. socket.broadcast.to('my-room').emit('hi!');\n     */\n    prototypeAccessors.broadcast.get = function () {\n      if (this.readyState !== SocketIO.OPEN) {\n        throw new Error('SocketIO is already in CLOSING or CLOSED state');\n      }\n      var self = this;\n      var server = networkBridge.serverLookup(this.url);\n      if (!server) {\n        throw new Error(\"SocketIO can not find a server at the specified URL (\" + this.url + \")\");\n      }\n      return {\n        emit: function emit(event, data) {\n          server.emit(event, data, {\n            websockets: networkBridge.websocketsLookup(self.url, null, self)\n          });\n          return self;\n        },\n        to: function to(room) {\n          return server.to(room, self);\n        },\n        in: function in$1(room) {\n          return server.in(room, self);\n        }\n      };\n    };\n\n    /*\n     * For registering events to be received from the server\n     */\n    SocketIO.prototype.on = function on(type, callback) {\n      this.addEventListener(type, callback);\n      return this;\n    };\n\n    /*\n     * Remove event listener\n     *\n     * https://github.com/component/emitter#emitteroffevent-fn\n     */\n    SocketIO.prototype.off = function off(type, callback) {\n      this.removeEventListener(type, callback);\n    };\n\n    /*\n     * Check if listeners have already been added for an event\n     *\n     * https://github.com/component/emitter#emitterhaslistenersevent\n     */\n    SocketIO.prototype.hasListeners = function hasListeners(type) {\n      var listeners = this.listeners[type];\n      if (!Array.isArray(listeners)) {\n        return false;\n      }\n      return !!listeners.length;\n    };\n\n    /*\n     * Join a room on a server\n     *\n     * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n     */\n    SocketIO.prototype.join = function join(room) {\n      networkBridge.addMembershipToRoom(this, room);\n    };\n\n    /*\n     * Get the websocket to leave the room\n     *\n     * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n     */\n    SocketIO.prototype.leave = function leave(room) {\n      networkBridge.removeMembershipFromRoom(this, room);\n    };\n    SocketIO.prototype.to = function to(room) {\n      return this.broadcast.to(room);\n    };\n    SocketIO.prototype.in = function in$1() {\n      return this.to.apply(null, arguments);\n    };\n\n    /*\n     * Invokes all listener functions that are listening to the given event.type property. Each\n     * listener will be passed the event as the first argument.\n     *\n     * @param {object} event - event object which will be passed to all listeners of the event.type property\n     */\n    SocketIO.prototype.dispatchEvent = function dispatchEvent(event) {\n      var this$1 = this;\n      var customArguments = [],\n        len = arguments.length - 1;\n      while (len-- > 0) customArguments[len] = arguments[len + 1];\n      var eventName = event.type;\n      var listeners = this.listeners[eventName];\n      if (!Array.isArray(listeners)) {\n        return false;\n      }\n      listeners.forEach(function (listener) {\n        if (customArguments.length > 0) {\n          listener.apply(this$1, customArguments);\n        } else {\n          // Regular WebSockets expect a MessageEvent but Socketio.io just wants raw data\n          //  payload instanceof MessageEvent works, but you can't isntance of NodeEvent\n          //  for now we detect if the output has data defined on it\n          listener.call(this$1, event.data ? event.data : event);\n        }\n      });\n    };\n    Object.defineProperties(SocketIO.prototype, prototypeAccessors);\n    return SocketIO;\n  }(EventTarget);\n  SocketIO$1.CONNECTING = 0;\n  SocketIO$1.OPEN = 1;\n  SocketIO$1.CLOSING = 2;\n  SocketIO$1.CLOSED = 3;\n\n  /*\n   * Static constructor methods for the IO Socket\n   */\n  var IO = function ioConstructor(url, protocol) {\n    return new SocketIO$1(url, protocol);\n  };\n\n  /*\n   * Alias the raw IO() constructor\n   */\n  IO.connect = function ioConnect(url, protocol) {\n    /* eslint-disable new-cap */\n    return IO(url, protocol);\n    /* eslint-enable new-cap */\n  };\n\n  var dedupe = function (arr) {\n    return arr.reduce(function (deduped, b) {\n      if (deduped.indexOf(b) > -1) {\n        return deduped;\n      }\n      return deduped.concat(b);\n    }, []);\n  };\n  function retrieveGlobalObject() {\n    if (typeof window !== 'undefined') {\n      return window;\n    }\n    return typeof process === 'object' && typeof require === 'function' && typeof global === 'object' ? global : this;\n  }\n  var defaultOptions = {\n    mock: true,\n    verifyClient: null,\n    selectProtocol: null\n  };\n  var Server$1 = function (EventTarget$$1) {\n    function Server(url, options) {\n      if (options === void 0) options = defaultOptions;\n      EventTarget$$1.call(this);\n      var urlRecord = new urlParse(url);\n      if (!urlRecord.pathname) {\n        urlRecord.pathname = '/';\n      }\n      this.url = urlRecord.toString();\n      this.originalWebSocket = null;\n      var server = networkBridge.attachServer(this, this.url);\n      if (!server) {\n        this.dispatchEvent(createEvent({\n          type: 'error'\n        }));\n        throw new Error('A mock server is already listening on this url');\n      }\n      this.options = Object.assign({}, defaultOptions, options);\n      if (this.options.mock) {\n        this.mockWebsocket();\n      }\n    }\n    if (EventTarget$$1) Server.__proto__ = EventTarget$$1;\n    Server.prototype = Object.create(EventTarget$$1 && EventTarget$$1.prototype);\n    Server.prototype.constructor = Server;\n\n    /*\n     * Attaches the mock websocket object to the global object\n     */\n    Server.prototype.mockWebsocket = function mockWebsocket() {\n      var globalObj = retrieveGlobalObject();\n      this.originalWebSocket = globalObj.WebSocket;\n      globalObj.WebSocket = WebSocket$1;\n    };\n\n    /*\n     * Removes the mock websocket object from the global object\n     */\n    Server.prototype.restoreWebsocket = function restoreWebsocket() {\n      var globalObj = retrieveGlobalObject();\n      if (this.originalWebSocket !== null) {\n        globalObj.WebSocket = this.originalWebSocket;\n      }\n      this.originalWebSocket = null;\n    };\n\n    /**\n     * Removes itself from the urlMap so another server could add itself to the url.\n     * @param {function} callback - The callback is called when the server is stopped\n     */\n    Server.prototype.stop = function stop(callback) {\n      if (callback === void 0) callback = function () {};\n      if (this.options.mock) {\n        this.restoreWebsocket();\n      }\n      networkBridge.removeServer(this.url);\n      if (typeof callback === 'function') {\n        callback();\n      }\n    };\n\n    /*\n     * This is the main function for the mock server to subscribe to the on events.\n     *\n     * ie: mockServer.on('connection', function() { console.log('a mock client connected'); });\n     *\n     * @param {string} type - The event key to subscribe to. Valid keys are: connection, message, and close.\n     * @param {function} callback - The callback which should be called when a certain event is fired.\n     */\n    Server.prototype.on = function on(type, callback) {\n      this.addEventListener(type, callback);\n    };\n\n    /*\n     * Remove event listener\n     */\n    Server.prototype.off = function off(type, callback) {\n      this.removeEventListener(type, callback);\n    };\n\n    /*\n     * Closes the connection and triggers the onclose method of all listening\n     * websockets. After that it removes itself from the urlMap so another server\n     * could add itself to the url.\n     *\n     * @param {object} options\n     */\n    Server.prototype.close = function close(options) {\n      if (options === void 0) options = {};\n      var code = options.code;\n      var reason = options.reason;\n      var wasClean = options.wasClean;\n      var listeners = networkBridge.websocketsLookup(this.url);\n\n      // Remove server before notifications to prevent immediate reconnects from\n      // socket onclose handlers\n      networkBridge.removeServer(this.url);\n      listeners.forEach(function (socket) {\n        socket.readyState = WebSocket$1.CLOSED;\n        socket.dispatchEvent(createCloseEvent({\n          type: 'close',\n          target: socket.target,\n          code: code || CLOSE_CODES.CLOSE_NORMAL,\n          reason: reason || '',\n          wasClean: wasClean\n        }));\n      });\n      this.dispatchEvent(createCloseEvent({\n        type: 'close'\n      }), this);\n    };\n\n    /*\n     * Sends a generic message event to all mock clients.\n     */\n    Server.prototype.emit = function emit(event, data, options) {\n      var this$1 = this;\n      if (options === void 0) options = {};\n      var websockets = options.websockets;\n      if (!websockets) {\n        websockets = networkBridge.websocketsLookup(this.url);\n      }\n      var normalizedData;\n      if (typeof options !== 'object' || arguments.length > 3) {\n        data = Array.prototype.slice.call(arguments, 1, arguments.length);\n        normalizedData = data.map(function (item) {\n          return normalizeSendData(item);\n        });\n      } else {\n        normalizedData = normalizeSendData(data);\n      }\n      websockets.forEach(function (socket) {\n        var messageData = socket instanceof SocketIO$1 ? data : normalizedData;\n        if (Array.isArray(messageData)) {\n          socket.dispatchEvent.apply(socket, [createMessageEvent({\n            type: event,\n            data: messageData,\n            origin: this$1.url,\n            target: socket.target\n          })].concat(messageData));\n        } else {\n          socket.dispatchEvent(createMessageEvent({\n            type: event,\n            data: messageData,\n            origin: this$1.url,\n            target: socket.target\n          }));\n        }\n      });\n    };\n\n    /*\n     * Returns an array of websockets which are listening to this server\n     * TOOD: this should return a set and not be a method\n     */\n    Server.prototype.clients = function clients() {\n      return networkBridge.websocketsLookup(this.url);\n    };\n\n    /*\n     * Prepares a method to submit an event to members of the room\n     *\n     * e.g. server.to('my-room').emit('hi!');\n     */\n    Server.prototype.to = function to(room, broadcaster, broadcastList) {\n      var this$1 = this;\n      if (broadcastList === void 0) broadcastList = [];\n      var self = this;\n      var websockets = dedupe(broadcastList.concat(networkBridge.websocketsLookup(this.url, room, broadcaster)));\n      return {\n        to: function (chainedRoom, chainedBroadcaster) {\n          return this$1.to.call(this$1, chainedRoom, chainedBroadcaster, websockets);\n        },\n        emit: function emit(event, data) {\n          self.emit(event, data, {\n            websockets: websockets\n          });\n        }\n      };\n    };\n\n    /*\n     * Alias for Server.to\n     */\n    Server.prototype.in = function in$1() {\n      var args = [],\n        len = arguments.length;\n      while (len--) args[len] = arguments[len];\n      return this.to.apply(null, args);\n    };\n\n    /*\n     * Simulate an event from the server to the clients. Useful for\n     * simulating errors.\n     */\n    Server.prototype.simulate = function simulate(event) {\n      var listeners = networkBridge.websocketsLookup(this.url);\n      if (event === 'error') {\n        listeners.forEach(function (socket) {\n          socket.readyState = WebSocket$1.CLOSED;\n          socket.dispatchEvent(createEvent({\n            type: 'error',\n            target: socket.target\n          }));\n        });\n      }\n    };\n    return Server;\n  }(EventTarget);\n\n  /*\n   * Alternative constructor to support namespaces in socket.io\n   *\n   * http://socket.io/docs/rooms-and-namespaces/#custom-namespaces\n   */\n  Server$1.of = function of(url) {\n    return new Server$1(url);\n  };\n  var Server = Server$1;\n  var WebSocket = WebSocket$1;\n  var SocketIO$$1 = IO;\n  exports.Server = Server;\n  exports.WebSocket = WebSocket;\n  exports.SocketIO = SocketIO$$1;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","map":{"version":3,"names":["global","factory","exports","module","define","amd","Mock","commonjsGlobal","window","self","requiresPort","required","port","protocol","split","has","Object","prototype","hasOwnProperty","undef","decode","input","decodeURIComponent","replace","e","encode","encodeURIComponent","querystring","query","parser","result","part","exec","key","value","querystringify","obj","prefix","pairs","call","isNaN","push","length","join","stringify","parse","querystringify_1","CRHTLF","slashes","protocolre","windowsDriveLetter","whitespace","trimLeft","str","toString","rules","sanitize","address","url","isSpecial","NaN","undefined","ignore","hash","lolcation","loc","globalVar","location","finaldestination","type","Url","unescape","pathname","test","href","scheme","extractProtocol","match","toLowerCase","forwardSlashes","otherSlashes","slashesCount","rest","slice","resolve","relative","base","path","concat","i","last","unshift","up","splice","extracted","instruction","index","instructions","lastIndexOf","indexOf","charAt","host","hostname","username","password","auth","origin","set","fn","pop","char","ins","qs","urlParse","delay","callback","context","setTimeout","timeoutContext","log","method","message","process","env","NODE_ENV","console","reject","array","results","forEach","itemInArray","filter","EventTarget","listeners","addEventListener","listener","Array","isArray","item","removeEventListener","removingListener","arrayOfListeners","dispatchEvent","event","this$1","customArguments","len","arguments","eventName","apply","trimQueryPartFromURL","queryIndex","NetworkBridge","urlMap","attachWebSocket","websocket","serverURL","connectionLookup","server","websockets","addMembershipToRoom","room","roomMemberships","attachServer","serverUrl","serverLookup","websocketsLookup","broadcaster","members","removeServer","removeWebSocket","socket","removeMembershipFromRoom","memberships","networkBridge","CLOSE_CODES","CLOSE_NORMAL","CLOSE_GOING_AWAY","CLOSE_PROTOCOL_ERROR","CLOSE_UNSUPPORTED","CLOSE_NO_STATUS","CLOSE_ABNORMAL","UNSUPPORTED_DATA","POLICY_VIOLATION","CLOSE_TOO_LARGE","MISSING_EXTENSION","INTERNAL_ERROR","SERVICE_RESTART","TRY_AGAIN_LATER","TLS_HANDSHAKE","ERROR_PREFIX","CONSTRUCTOR_ERROR","CLOSE_ERROR","EVENT","CONSTRUCT","MESSAGE","CLOSE","EventPrototype","stopPropagation","stopImmediatePropagation","initEvent","bubbles","cancelable","Boolean","Event","EventPrototype$$1","eventInitConfig","TypeError","EVENT_ERROR","timeStamp","Date","now","target","srcElement","returnValue","isTrusted","eventPhase","defaultPrevented","currentTarget","cancelBubble","__proto__","create","constructor","MessageEvent","data","lastEventId","ports","canncelBubble","CloseEvent","code","reason","wasClean","parseInt","createEvent","config","eventObject","createMessageEvent","messageEvent","createCloseEvent","closeEvent","closeWebSocketConnection","readyState","WebSocket$1","CLOSING","CLOSED","failWebSocketConnection","errorEvent","normalizeSendData","ArrayBuffer","String","proxies","WeakMap","proxyFactory","get","proxy","Proxy","prop","close","options","send","toSocketName","onWrapper","cb","offWrapper","lengthInUtf8Bytes","m","urlVerification","urlRecord","SyntaxError","protocolVerification","protocols","uniq","map","p","count","reduce","a","b","duplicates","keys","EventTarget$$1","WebSocket","_onopen","_onmessage","_onerror","_onclose","binaryType","CONNECTING","client","delayCallback","verifyClient","selectProtocol","selectedProtocol","isFilled","isRequested","OPEN","prototypeAccessors","onopen","onmessage","onclose","onerror","Error","defineProperties","SocketIO$1","SocketIO","broadcast","disconnect","emit","to","in","in$1","on","off","hasListeners","leave","IO","ioConstructor","connect","ioConnect","dedupe","arr","deduped","retrieveGlobalObject","require","defaultOptions","mock","Server$1","Server","originalWebSocket","assign","mockWebsocket","globalObj","restoreWebsocket","stop","normalizedData","messageData","clients","broadcastList","chainedRoom","chainedBroadcaster","args","simulate","of","SocketIO$$1","defineProperty"],"sources":["/home/saif/Documents/Proxym/redux-essentials-example-app/node_modules/mock-socket/dist/mock-socket.js"],"sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.Mock = global.Mock || {})));\n}(this, (function (exports) { 'use strict';\n\nvar commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nvar requiresPort = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) { return false; }\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n\nvar has = Object.prototype.hasOwnProperty;\nvar undef;\n\n/**\n * Decode a URI encoded string.\n *\n * @param {String} input The URI encoded string.\n * @returns {String|Null} The decoded string.\n * @api private\n */\nfunction decode(input) {\n  try {\n    return decodeURIComponent(input.replace(/\\+/g, ' '));\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Attempts to encode a given input.\n *\n * @param {String} input The string that needs to be encoded.\n * @returns {String|Null} The encoded string.\n * @api private\n */\nfunction encode(input) {\n  try {\n    return encodeURIComponent(input);\n  } catch (e) {\n    return null;\n  }\n}\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?#&]+)=?([^&]*)/g\n    , result = {}\n    , part;\n\n  while (part = parser.exec(query)) {\n    var key = decode(part[1])\n      , value = decode(part[2]);\n\n    //\n    // Prevent overriding of existing properties. This ensures that build-in\n    // methods like `toString` or __proto__ are not overriden by malicious\n    // querystrings.\n    //\n    // In the case if failed decoding, we want to omit the key/value pairs\n    // from the result.\n    //\n    if (key === null || value === null || key in result) { continue; }\n    result[key] = value;\n  }\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = []\n    , value\n    , key;\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) { prefix = '?'; }\n\n  for (key in obj) {\n    if (has.call(obj, key)) {\n      value = obj[key];\n\n      //\n      // Edge cases where we actually want to encode the value to an empty\n      // string instead of the stringified value.\n      //\n      if (!value && (value === null || value === undef || isNaN(value))) {\n        value = '';\n      }\n\n      key = encode(key);\n      value = encode(value);\n\n      //\n      // If we failed to encode the strings, we should bail out as we don't\n      // want to add invalid strings to the query.\n      //\n      if (key === null || value === null) { continue; }\n      pairs.push(key +'='+ value);\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nvar stringify = querystringify;\nvar parse = querystring;\n\nvar querystringify_1 = {\n\tstringify: stringify,\n\tparse: parse\n};\n\nvar CRHTLF = /[\\n\\r\\t]/g;\nvar slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//;\nvar protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\\\/]+)?([\\S\\s]*)/i;\nvar windowsDriveLetter = /^[a-zA-Z]:/;\nvar whitespace = /^[\\x00-\\x20\\u00a0\\u1680\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]+/;\n\n/**\n * Trim a given string.\n *\n * @param {String} str String to trim.\n * @public\n */\nfunction trimLeft(str) {\n  return (str ? str : '').toString().replace(whitespace, '');\n}\n\n/**\n * These are the parse rules for the URL parser, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar rules = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  function sanitize(address, url) {     // Sanitize what is left of the address\n    return isSpecial(url.protocol) ? address.replace(/\\\\/g, '/') : address;\n  },\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/:(\\d*)$/, 'port', undefined, 1],    // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 };\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object|String} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @public\n */\nfunction lolcation(loc) {\n  var globalVar;\n\n  if (typeof window !== 'undefined') { globalVar = window; }\n  else if (typeof commonjsGlobal !== 'undefined') { globalVar = commonjsGlobal; }\n  else if (typeof self !== 'undefined') { globalVar = self; }\n  else { globalVar = {}; }\n\n  var location = globalVar.location || {};\n  loc = loc || location;\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new Url(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new Url(loc, {});\n    for (key in ignore) { delete finaldestination[key]; }\n  } else if ('object' === type) {\n    for (key in loc) {\n      if (key in ignore) { continue; }\n      finaldestination[key] = loc[key];\n    }\n\n    if (finaldestination.slashes === undefined) {\n      finaldestination.slashes = slashes.test(loc.href);\n    }\n  }\n\n  return finaldestination;\n}\n\n/**\n * Check whether a protocol scheme is special.\n *\n * @param {String} The protocol scheme of the URL\n * @return {Boolean} `true` if the protocol scheme is special, else `false`\n * @private\n */\nfunction isSpecial(scheme) {\n  return (\n    scheme === 'file:' ||\n    scheme === 'ftp:' ||\n    scheme === 'http:' ||\n    scheme === 'https:' ||\n    scheme === 'ws:' ||\n    scheme === 'wss:'\n  );\n}\n\n/**\n * @typedef ProtocolExtract\n * @type Object\n * @property {String} protocol Protocol matched in the URL, in lowercase.\n * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n * @property {String} rest Rest of the URL that is not part of the protocol.\n */\n\n/**\n * Extract protocol information from a URL with/without double slash (\"//\").\n *\n * @param {String} address URL we want to extract from.\n * @param {Object} location\n * @return {ProtocolExtract} Extracted information.\n * @private\n */\nfunction extractProtocol(address, location) {\n  address = trimLeft(address);\n  address = address.replace(CRHTLF, '');\n  location = location || {};\n\n  var match = protocolre.exec(address);\n  var protocol = match[1] ? match[1].toLowerCase() : '';\n  var forwardSlashes = !!match[2];\n  var otherSlashes = !!match[3];\n  var slashesCount = 0;\n  var rest;\n\n  if (forwardSlashes) {\n    if (otherSlashes) {\n      rest = match[2] + match[3] + match[4];\n      slashesCount = match[2].length + match[3].length;\n    } else {\n      rest = match[2] + match[4];\n      slashesCount = match[2].length;\n    }\n  } else {\n    if (otherSlashes) {\n      rest = match[3] + match[4];\n      slashesCount = match[3].length;\n    } else {\n      rest = match[4];\n    }\n  }\n\n  if (protocol === 'file:') {\n    if (slashesCount >= 2) {\n      rest = rest.slice(2);\n    }\n  } else if (isSpecial(protocol)) {\n    rest = match[4];\n  } else if (protocol) {\n    if (forwardSlashes) {\n      rest = rest.slice(2);\n    }\n  } else if (slashesCount >= 2 && isSpecial(location.protocol)) {\n    rest = match[4];\n  }\n\n  return {\n    protocol: protocol,\n    slashes: forwardSlashes || isSpecial(protocol),\n    slashesCount: slashesCount,\n    rest: rest\n  };\n}\n\n/**\n * Resolve a relative URL pathname against a base URL pathname.\n *\n * @param {String} relative Pathname of the relative URL.\n * @param {String} base Pathname of the base URL.\n * @return {String} Resolved pathname.\n * @private\n */\nfunction resolve(relative, base) {\n  if (relative === '') { return base; }\n\n  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))\n    , i = path.length\n    , last = path[i - 1]\n    , unshift = false\n    , up = 0;\n\n  while (i--) {\n    if (path[i] === '.') {\n      path.splice(i, 1);\n    } else if (path[i] === '..') {\n      path.splice(i, 1);\n      up++;\n    } else if (up) {\n      if (i === 0) { unshift = true; }\n      path.splice(i, 1);\n      up--;\n    }\n  }\n\n  if (unshift) { path.unshift(''); }\n  if (last === '.' || last === '..') { path.push(''); }\n\n  return path.join('/');\n}\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my OCD.\n *\n * It is worth noting that we should not use `URL` as class name to prevent\n * clashes with the global URL instance that got introduced in browsers.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Object|String} [location] Location defaults for relative paths.\n * @param {Boolean|Function} [parser] Parser for the query string.\n * @private\n */\nfunction Url(address, location, parser) {\n  address = trimLeft(address);\n  address = address.replace(CRHTLF, '');\n\n  if (!(this instanceof Url)) {\n    return new Url(address, location, parser);\n  }\n\n  var relative, extracted, parse, instruction, index, key\n    , instructions = rules.slice()\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) { parser = querystringify_1.parse; }\n\n  location = lolcation(location);\n\n  //\n  // Extract protocol information before running the instructions.\n  //\n  extracted = extractProtocol(address || '', location);\n  relative = !extracted.protocol && !extracted.slashes;\n  url.slashes = extracted.slashes || relative && location.slashes;\n  url.protocol = extracted.protocol || location.protocol || '';\n  address = extracted.rest;\n\n  //\n  // When the authority component is absent the URL starts with a path\n  // component.\n  //\n  if (\n    extracted.protocol === 'file:' && (\n      extracted.slashesCount !== 2 || windowsDriveLetter.test(address)) ||\n    (!extracted.slashes &&\n      (extracted.protocol ||\n        extracted.slashesCount < 2 ||\n        !isSpecial(url.protocol)))\n  ) {\n    instructions[3] = [/(.*)/, 'pathname'];\n  }\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n\n    if (typeof instruction === 'function') {\n      address = instruction(address, url);\n      continue;\n    }\n\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      index = parse === '@'\n        ? address.lastIndexOf(parse)\n        : address.indexOf(parse);\n\n      if (~index) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if ((index = parse.exec(address))) {\n      url[key] = index[1];\n      address = address.slice(0, index.index);\n    }\n\n    url[key] = url[key] || (\n      relative && instruction[3] ? location[key] || '' : ''\n    );\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) { url[key] = url[key].toLowerCase(); }\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) { url.query = parser(url.query); }\n\n  //\n  // If the URL is relative, resolve the pathname against the base URL.\n  //\n  if (\n      relative\n    && location.slashes\n    && url.pathname.charAt(0) !== '/'\n    && (url.pathname !== '' || location.pathname !== '')\n  ) {\n    url.pathname = resolve(url.pathname, location.pathname);\n  }\n\n  //\n  // Default to a / for pathname if none exists. This normalizes the URL\n  // to always have a /\n  //\n  if (url.pathname.charAt(0) !== '/' && isSpecial(url.protocol)) {\n    url.pathname = '/' + url.pathname;\n  }\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!requiresPort(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n\n  if (url.auth) {\n    index = url.auth.indexOf(':');\n\n    if (~index) {\n      url.username = url.auth.slice(0, index);\n      url.username = encodeURIComponent(decodeURIComponent(url.username));\n\n      url.password = url.auth.slice(index + 1);\n      url.password = encodeURIComponent(decodeURIComponent(url.password));\n    } else {\n      url.username = encodeURIComponent(decodeURIComponent(url.auth));\n    }\n\n    url.auth = url.password ? url.username +':'+ url.password : url.username;\n  }\n\n  url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} part          Property we need to adjust.\n * @param {Mixed} value          The newly assigned value.\n * @param {Boolean|Function} fn  When setting the query, it will be the function\n *                               used to parse the query.\n *                               When setting the protocol, double slash will be\n *                               removed from the final url if it is true.\n * @returns {URL} URL instance for chaining.\n * @public\n */\nfunction set(part, value, fn) {\n  var url = this;\n\n  switch (part) {\n    case 'query':\n      if ('string' === typeof value && value.length) {\n        value = (fn || querystringify_1.parse)(value);\n      }\n\n      url[part] = value;\n      break;\n\n    case 'port':\n      url[part] = value;\n\n      if (!requiresPort(value, url.protocol)) {\n        url.host = url.hostname;\n        url[part] = '';\n      } else if (value) {\n        url.host = url.hostname +':'+ value;\n      }\n\n      break;\n\n    case 'hostname':\n      url[part] = value;\n\n      if (url.port) { value += ':'+ url.port; }\n      url.host = value;\n      break;\n\n    case 'host':\n      url[part] = value;\n\n      if (/:\\d+$/.test(value)) {\n        value = value.split(':');\n        url.port = value.pop();\n        url.hostname = value.join(':');\n      } else {\n        url.hostname = value;\n        url.port = '';\n      }\n\n      break;\n\n    case 'protocol':\n      url.protocol = value.toLowerCase();\n      url.slashes = !fn;\n      break;\n\n    case 'pathname':\n    case 'hash':\n      if (value) {\n        var char = part === 'pathname' ? '/' : '#';\n        url[part] = value.charAt(0) !== char ? char + value : value;\n      } else {\n        url[part] = value;\n      }\n      break;\n\n    case 'username':\n    case 'password':\n      url[part] = encodeURIComponent(value);\n      break;\n\n    case 'auth':\n      var index = value.indexOf(':');\n\n      if (~index) {\n        url.username = value.slice(0, index);\n        url.username = encodeURIComponent(decodeURIComponent(url.username));\n\n        url.password = value.slice(index + 1);\n        url.password = encodeURIComponent(decodeURIComponent(url.password));\n      } else {\n        url.username = encodeURIComponent(decodeURIComponent(value));\n      }\n  }\n\n  for (var i = 0; i < rules.length; i++) {\n    var ins = rules[i];\n\n    if (ins[4]) { url[ins[1]] = url[ins[1]].toLowerCase(); }\n  }\n\n  url.auth = url.password ? url.username +':'+ url.password : url.username;\n\n  url.origin = url.protocol !== 'file:' && isSpecial(url.protocol) && url.host\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  url.href = url.toString();\n\n  return url;\n}\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String} Compiled version of the URL.\n * @public\n */\nfunction toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) { stringify = querystringify_1.stringify; }\n\n  var query\n    , url = this\n    , host = url.host\n    , protocol = url.protocol;\n\n  if (protocol && protocol.charAt(protocol.length - 1) !== ':') { protocol += ':'; }\n\n  var result =\n    protocol +\n    ((url.protocol && url.slashes) || isSpecial(url.protocol) ? '//' : '');\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) { result += ':'+ url.password; }\n    result += '@';\n  } else if (url.password) {\n    result += ':'+ url.password;\n    result += '@';\n  } else if (\n    url.protocol !== 'file:' &&\n    isSpecial(url.protocol) &&\n    !host &&\n    url.pathname !== '/'\n  ) {\n    //\n    // Add back the empty userinfo, otherwise the original invalid URL\n    // might be transformed into a valid one with `url.pathname` as host.\n    //\n    result += '@';\n  }\n\n  //\n  // Trailing colon is removed from `url.host` when it is parsed. If it still\n  // ends with a colon, then add back the trailing colon that was removed. This\n  // prevents an invalid URL from being transformed into a valid one.\n  //\n  if (host[host.length - 1] === ':') { host += ':'; }\n  result += host + url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) { result += '?' !== query.charAt(0) ? '?'+ query : query; }\n\n  if (url.hash) { result += url.hash; }\n\n  return result;\n}\n\nUrl.prototype = { set: set, toString: toString };\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others or testing.\n//\nUrl.extractProtocol = extractProtocol;\nUrl.location = lolcation;\nUrl.trimLeft = trimLeft;\nUrl.qs = querystringify_1;\n\nvar urlParse = Url;\n\n/*\n * This delay allows the thread to finish assigning its on* methods\n * before invoking the delay callback. This is purely a timing hack.\n * http://geekabyte.blogspot.com/2014/01/javascript-effect-of-setting-settimeout.html\n *\n * @param {callback: function} the callback which will be invoked after the timeout\n * @parma {context: object} the context in which to invoke the function\n */\nfunction delay(callback, context) {\n  setTimeout(function (timeoutContext) { return callback.call(timeoutContext); }, 4, context);\n}\n\nfunction log(method, message) {\n  /* eslint-disable no-console */\n  if (typeof process !== 'undefined' && process.env.NODE_ENV !== 'test') {\n    console[method].call(null, message);\n  }\n  /* eslint-enable no-console */\n}\n\nfunction reject(array, callback) {\n  if ( array === void 0 ) array = [];\n\n  var results = [];\n  array.forEach(function (itemInArray) {\n    if (!callback(itemInArray)) {\n      results.push(itemInArray);\n    }\n  });\n\n  return results;\n}\n\nfunction filter(array, callback) {\n  if ( array === void 0 ) array = [];\n\n  var results = [];\n  array.forEach(function (itemInArray) {\n    if (callback(itemInArray)) {\n      results.push(itemInArray);\n    }\n  });\n\n  return results;\n}\n\n/*\n * EventTarget is an interface implemented by objects that can\n * receive events and may have listeners for them.\n *\n * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget\n */\nvar EventTarget = function EventTarget() {\n  this.listeners = {};\n};\n\n/*\n * Ties a listener function to an event type which can later be invoked via the\n * dispatchEvent method.\n *\n * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n */\nEventTarget.prototype.addEventListener = function addEventListener (type, listener /* , useCapture */) {\n  if (typeof listener === 'function') {\n    if (!Array.isArray(this.listeners[type])) {\n      this.listeners[type] = [];\n    }\n\n    // Only add the same function once\n    if (filter(this.listeners[type], function (item) { return item === listener; }).length === 0) {\n      this.listeners[type].push(listener);\n    }\n  }\n};\n\n/*\n * Removes the listener so it will no longer be invoked via the dispatchEvent method.\n *\n * @param {string} type - the type of event (ie: 'open', 'message', etc.)\n * @param {function} listener - callback function to invoke when an event is dispatched matching the type\n * @param {boolean} useCapture - N/A TODO: implement useCapture functionality\n */\nEventTarget.prototype.removeEventListener = function removeEventListener (type, removingListener /* , useCapture */) {\n  var arrayOfListeners = this.listeners[type];\n  this.listeners[type] = reject(arrayOfListeners, function (listener) { return listener === removingListener; });\n};\n\n/*\n * Invokes all listener functions that are listening to the given event.type property. Each\n * listener will be passed the event as the first argument.\n *\n * @param {object} event - event object which will be passed to all listeners of the event.type property\n */\nEventTarget.prototype.dispatchEvent = function dispatchEvent (event) {\n    var this$1 = this;\n    var customArguments = [], len = arguments.length - 1;\n    while ( len-- > 0 ) customArguments[ len ] = arguments[ len + 1 ];\n\n  var eventName = event.type;\n  var listeners = this.listeners[eventName];\n\n  if (!Array.isArray(listeners)) {\n    return false;\n  }\n\n  listeners.forEach(function (listener) {\n    if (customArguments.length > 0) {\n      listener.apply(this$1, customArguments);\n    } else {\n      listener.call(this$1, event);\n    }\n  });\n\n  return true;\n};\n\nfunction trimQueryPartFromURL(url) {\n  var queryIndex = url.indexOf('?');\n  return queryIndex >= 0 ? url.slice(0, queryIndex) : url;\n}\n\n/*\n * The network bridge is a way for the mock websocket object to 'communicate' with\n * all available servers. This is a singleton object so it is important that you\n * clean up urlMap whenever you are finished.\n */\nvar NetworkBridge = function NetworkBridge() {\n  this.urlMap = {};\n};\n\n/*\n * Attaches a websocket object to the urlMap hash so that it can find the server\n * it is connected to and the server in turn can find it.\n *\n * @param {object} websocket - websocket object to add to the urlMap hash\n * @param {string} url\n */\nNetworkBridge.prototype.attachWebSocket = function attachWebSocket (websocket, url) {\n  var serverURL = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverURL];\n\n  if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) === -1) {\n    connectionLookup.websockets.push(websocket);\n    return connectionLookup.server;\n  }\n};\n\n/*\n * Attaches a websocket to a room\n */\nNetworkBridge.prototype.addMembershipToRoom = function addMembershipToRoom (websocket, room) {\n  var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n\n  if (connectionLookup && connectionLookup.server && connectionLookup.websockets.indexOf(websocket) !== -1) {\n    if (!connectionLookup.roomMemberships[room]) {\n      connectionLookup.roomMemberships[room] = [];\n    }\n\n    connectionLookup.roomMemberships[room].push(websocket);\n  }\n};\n\n/*\n * Attaches a server object to the urlMap hash so that it can find a websockets\n * which are connected to it and so that websockets can in turn can find it.\n *\n * @param {object} server - server object to add to the urlMap hash\n * @param {string} url\n */\nNetworkBridge.prototype.attachServer = function attachServer (server, url) {\n  var serverUrl = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverUrl];\n\n  if (!connectionLookup) {\n    this.urlMap[serverUrl] = {\n      server: server,\n      websockets: [],\n      roomMemberships: {}\n    };\n\n    return server;\n  }\n};\n\n/*\n * Finds the server which is 'running' on the given url.\n *\n * @param {string} url - the url to use to find which server is running on it\n */\nNetworkBridge.prototype.serverLookup = function serverLookup (url) {\n  var serverURL = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverURL];\n\n  if (connectionLookup) {\n    return connectionLookup.server;\n  }\n};\n\n/*\n * Finds all websockets which is 'listening' on the given url.\n *\n * @param {string} url - the url to use to find all websockets which are associated with it\n * @param {string} room - if a room is provided, will only return sockets in this room\n * @param {class} broadcaster - socket that is broadcasting and is to be excluded from the lookup\n */\nNetworkBridge.prototype.websocketsLookup = function websocketsLookup (url, room, broadcaster) {\n  var serverURL = trimQueryPartFromURL(url);\n  var websockets;\n  var connectionLookup = this.urlMap[serverURL];\n\n  websockets = connectionLookup ? connectionLookup.websockets : [];\n\n  if (room) {\n    var members = connectionLookup.roomMemberships[room];\n    websockets = members || [];\n  }\n\n  return broadcaster ? websockets.filter(function (websocket) { return websocket !== broadcaster; }) : websockets;\n};\n\n/*\n * Removes the entry associated with the url.\n *\n * @param {string} url\n */\nNetworkBridge.prototype.removeServer = function removeServer (url) {\n  delete this.urlMap[trimQueryPartFromURL(url)];\n};\n\n/*\n * Removes the individual websocket from the map of associated websockets.\n *\n * @param {object} websocket - websocket object to remove from the url map\n * @param {string} url\n */\nNetworkBridge.prototype.removeWebSocket = function removeWebSocket (websocket, url) {\n  var serverURL = trimQueryPartFromURL(url);\n  var connectionLookup = this.urlMap[serverURL];\n\n  if (connectionLookup) {\n    connectionLookup.websockets = reject(connectionLookup.websockets, function (socket) { return socket === websocket; });\n  }\n};\n\n/*\n * Removes a websocket from a room\n */\nNetworkBridge.prototype.removeMembershipFromRoom = function removeMembershipFromRoom (websocket, room) {\n  var connectionLookup = this.urlMap[trimQueryPartFromURL(websocket.url)];\n  var memberships = connectionLookup.roomMemberships[room];\n\n  if (connectionLookup && memberships !== null) {\n    connectionLookup.roomMemberships[room] = reject(memberships, function (socket) { return socket === websocket; });\n  }\n};\n\nvar networkBridge = new NetworkBridge(); // Note: this is a singleton\n\n/*\n * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent\n */\nvar CLOSE_CODES = {\n  CLOSE_NORMAL: 1000,\n  CLOSE_GOING_AWAY: 1001,\n  CLOSE_PROTOCOL_ERROR: 1002,\n  CLOSE_UNSUPPORTED: 1003,\n  CLOSE_NO_STATUS: 1005,\n  CLOSE_ABNORMAL: 1006,\n  UNSUPPORTED_DATA: 1007,\n  POLICY_VIOLATION: 1008,\n  CLOSE_TOO_LARGE: 1009,\n  MISSING_EXTENSION: 1010,\n  INTERNAL_ERROR: 1011,\n  SERVICE_RESTART: 1012,\n  TRY_AGAIN_LATER: 1013,\n  TLS_HANDSHAKE: 1015\n};\n\nvar ERROR_PREFIX = {\n  CONSTRUCTOR_ERROR: \"Failed to construct 'WebSocket':\",\n  CLOSE_ERROR: \"Failed to execute 'close' on 'WebSocket':\",\n  EVENT: {\n    CONSTRUCT: \"Failed to construct 'Event':\",\n    MESSAGE: \"Failed to construct 'MessageEvent':\",\n    CLOSE: \"Failed to construct 'CloseEvent':\"\n  }\n};\n\nvar EventPrototype = function EventPrototype () {};\n\nEventPrototype.prototype.stopPropagation = function stopPropagation () {};\nEventPrototype.prototype.stopImmediatePropagation = function stopImmediatePropagation () {};\n\n// if no arguments are passed then the type is set to \"undefined\" on\n// chrome and safari.\nEventPrototype.prototype.initEvent = function initEvent (type, bubbles, cancelable) {\n    if ( type === void 0 ) type = 'undefined';\n    if ( bubbles === void 0 ) bubbles = false;\n    if ( cancelable === void 0 ) cancelable = false;\n\n  this.type = \"\" + type;\n  this.bubbles = Boolean(bubbles);\n  this.cancelable = Boolean(cancelable);\n};\n\nvar Event = (function (EventPrototype$$1) {\n  function Event(type, eventInitConfig) {\n    if ( eventInitConfig === void 0 ) eventInitConfig = {};\n\n    EventPrototype$$1.call(this);\n\n    if (!type) {\n      throw new TypeError(((ERROR_PREFIX.EVENT_ERROR) + \" 1 argument required, but only 0 present.\"));\n    }\n\n    if (typeof eventInitConfig !== 'object') {\n      throw new TypeError(((ERROR_PREFIX.EVENT_ERROR) + \" parameter 2 ('eventInitDict') is not an object.\"));\n    }\n\n    var bubbles = eventInitConfig.bubbles;\n    var cancelable = eventInitConfig.cancelable;\n\n    this.type = \"\" + type;\n    this.timeStamp = Date.now();\n    this.target = null;\n    this.srcElement = null;\n    this.returnValue = true;\n    this.isTrusted = false;\n    this.eventPhase = 0;\n    this.defaultPrevented = false;\n    this.currentTarget = null;\n    this.cancelable = cancelable ? Boolean(cancelable) : false;\n    this.cancelBubble = false;\n    this.bubbles = bubbles ? Boolean(bubbles) : false;\n  }\n\n  if ( EventPrototype$$1 ) Event.__proto__ = EventPrototype$$1;\n  Event.prototype = Object.create( EventPrototype$$1 && EventPrototype$$1.prototype );\n  Event.prototype.constructor = Event;\n\n  return Event;\n}(EventPrototype));\n\nvar MessageEvent = (function (EventPrototype$$1) {\n  function MessageEvent(type, eventInitConfig) {\n    if ( eventInitConfig === void 0 ) eventInitConfig = {};\n\n    EventPrototype$$1.call(this);\n\n    if (!type) {\n      throw new TypeError(((ERROR_PREFIX.EVENT.MESSAGE) + \" 1 argument required, but only 0 present.\"));\n    }\n\n    if (typeof eventInitConfig !== 'object') {\n      throw new TypeError(((ERROR_PREFIX.EVENT.MESSAGE) + \" parameter 2 ('eventInitDict') is not an object\"));\n    }\n\n    var bubbles = eventInitConfig.bubbles;\n    var cancelable = eventInitConfig.cancelable;\n    var data = eventInitConfig.data;\n    var origin = eventInitConfig.origin;\n    var lastEventId = eventInitConfig.lastEventId;\n    var ports = eventInitConfig.ports;\n\n    this.type = \"\" + type;\n    this.timeStamp = Date.now();\n    this.target = null;\n    this.srcElement = null;\n    this.returnValue = true;\n    this.isTrusted = false;\n    this.eventPhase = 0;\n    this.defaultPrevented = false;\n    this.currentTarget = null;\n    this.cancelable = cancelable ? Boolean(cancelable) : false;\n    this.canncelBubble = false;\n    this.bubbles = bubbles ? Boolean(bubbles) : false;\n    this.origin = \"\" + origin;\n    this.ports = typeof ports === 'undefined' ? null : ports;\n    this.data = typeof data === 'undefined' ? null : data;\n    this.lastEventId = \"\" + (lastEventId || '');\n  }\n\n  if ( EventPrototype$$1 ) MessageEvent.__proto__ = EventPrototype$$1;\n  MessageEvent.prototype = Object.create( EventPrototype$$1 && EventPrototype$$1.prototype );\n  MessageEvent.prototype.constructor = MessageEvent;\n\n  return MessageEvent;\n}(EventPrototype));\n\nvar CloseEvent = (function (EventPrototype$$1) {\n  function CloseEvent(type, eventInitConfig) {\n    if ( eventInitConfig === void 0 ) eventInitConfig = {};\n\n    EventPrototype$$1.call(this);\n\n    if (!type) {\n      throw new TypeError(((ERROR_PREFIX.EVENT.CLOSE) + \" 1 argument required, but only 0 present.\"));\n    }\n\n    if (typeof eventInitConfig !== 'object') {\n      throw new TypeError(((ERROR_PREFIX.EVENT.CLOSE) + \" parameter 2 ('eventInitDict') is not an object\"));\n    }\n\n    var bubbles = eventInitConfig.bubbles;\n    var cancelable = eventInitConfig.cancelable;\n    var code = eventInitConfig.code;\n    var reason = eventInitConfig.reason;\n    var wasClean = eventInitConfig.wasClean;\n\n    this.type = \"\" + type;\n    this.timeStamp = Date.now();\n    this.target = null;\n    this.srcElement = null;\n    this.returnValue = true;\n    this.isTrusted = false;\n    this.eventPhase = 0;\n    this.defaultPrevented = false;\n    this.currentTarget = null;\n    this.cancelable = cancelable ? Boolean(cancelable) : false;\n    this.cancelBubble = false;\n    this.bubbles = bubbles ? Boolean(bubbles) : false;\n    this.code = typeof code === 'number' ? parseInt(code, 10) : 0;\n    this.reason = \"\" + (reason || '');\n    this.wasClean = wasClean ? Boolean(wasClean) : false;\n  }\n\n  if ( EventPrototype$$1 ) CloseEvent.__proto__ = EventPrototype$$1;\n  CloseEvent.prototype = Object.create( EventPrototype$$1 && EventPrototype$$1.prototype );\n  CloseEvent.prototype.constructor = CloseEvent;\n\n  return CloseEvent;\n}(EventPrototype));\n\n/*\n * Creates an Event object and extends it to allow full modification of\n * its properties.\n *\n * @param {object} config - within config you will need to pass type and optionally target\n */\nfunction createEvent(config) {\n  var type = config.type;\n  var target = config.target;\n  var eventObject = new Event(type);\n\n  if (target) {\n    eventObject.target = target;\n    eventObject.srcElement = target;\n    eventObject.currentTarget = target;\n  }\n\n  return eventObject;\n}\n\n/*\n * Creates a MessageEvent object and extends it to allow full modification of\n * its properties.\n *\n * @param {object} config - within config: type, origin, data and optionally target\n */\nfunction createMessageEvent(config) {\n  var type = config.type;\n  var origin = config.origin;\n  var data = config.data;\n  var target = config.target;\n  var messageEvent = new MessageEvent(type, {\n    data: data,\n    origin: origin\n  });\n\n  if (target) {\n    messageEvent.target = target;\n    messageEvent.srcElement = target;\n    messageEvent.currentTarget = target;\n  }\n\n  return messageEvent;\n}\n\n/*\n * Creates a CloseEvent object and extends it to allow full modification of\n * its properties.\n *\n * @param {object} config - within config: type and optionally target, code, and reason\n */\nfunction createCloseEvent(config) {\n  var code = config.code;\n  var reason = config.reason;\n  var type = config.type;\n  var target = config.target;\n  var wasClean = config.wasClean;\n\n  if (!wasClean) {\n    wasClean = code === CLOSE_CODES.CLOSE_NORMAL || code === CLOSE_CODES.CLOSE_NO_STATUS;\n  }\n\n  var closeEvent = new CloseEvent(type, {\n    code: code,\n    reason: reason,\n    wasClean: wasClean\n  });\n\n  if (target) {\n    closeEvent.target = target;\n    closeEvent.srcElement = target;\n    closeEvent.currentTarget = target;\n  }\n\n  return closeEvent;\n}\n\nfunction closeWebSocketConnection(context, code, reason) {\n  context.readyState = WebSocket$1.CLOSING;\n\n  var server = networkBridge.serverLookup(context.url);\n  var closeEvent = createCloseEvent({\n    type: 'close',\n    target: context.target,\n    code: code,\n    reason: reason\n  });\n\n  delay(function () {\n    networkBridge.removeWebSocket(context, context.url);\n\n    context.readyState = WebSocket$1.CLOSED;\n    context.dispatchEvent(closeEvent);\n\n    if (server) {\n      server.dispatchEvent(closeEvent, server);\n    }\n  }, context);\n}\n\nfunction failWebSocketConnection(context, code, reason) {\n  context.readyState = WebSocket$1.CLOSING;\n\n  var server = networkBridge.serverLookup(context.url);\n  var closeEvent = createCloseEvent({\n    type: 'close',\n    target: context.target,\n    code: code,\n    reason: reason,\n    wasClean: false\n  });\n\n  var errorEvent = createEvent({\n    type: 'error',\n    target: context.target\n  });\n\n  delay(function () {\n    networkBridge.removeWebSocket(context, context.url);\n\n    context.readyState = WebSocket$1.CLOSED;\n    context.dispatchEvent(errorEvent);\n    context.dispatchEvent(closeEvent);\n\n    if (server) {\n      server.dispatchEvent(closeEvent, server);\n    }\n  }, context);\n}\n\nfunction normalizeSendData(data) {\n  if (Object.prototype.toString.call(data) !== '[object Blob]' && !(data instanceof ArrayBuffer)) {\n    data = String(data);\n  }\n\n  return data;\n}\n\nvar proxies = new WeakMap();\n\nfunction proxyFactory(target) {\n  if (proxies.has(target)) {\n    return proxies.get(target);\n  }\n\n  var proxy = new Proxy(target, {\n    get: function get(obj, prop) {\n      if (prop === 'close') {\n        return function close(options) {\n          if ( options === void 0 ) options = {};\n\n          var code = options.code || CLOSE_CODES.CLOSE_NORMAL;\n          var reason = options.reason || '';\n\n          closeWebSocketConnection(proxy, code, reason);\n        };\n      }\n\n      if (prop === 'send') {\n        return function send(data) {\n          data = normalizeSendData(data);\n\n          target.dispatchEvent(\n            createMessageEvent({\n              type: 'message',\n              data: data,\n              origin: this.url,\n              target: target\n            })\n          );\n        };\n      }\n\n      var toSocketName = function (type) { return (type === 'message' ? (\"server::\" + type) : type); };\n      if (prop === 'on') {\n        return function onWrapper(type, cb) {\n          target.addEventListener(toSocketName(type), cb);\n        };\n      }\n      if (prop === 'off') {\n        return function offWrapper(type, cb) {\n          target.removeEventListener(toSocketName(type), cb);\n        };\n      }\n\n      if (prop === 'target') {\n        return target;\n      }\n\n      return obj[prop];\n    }\n  });\n  proxies.set(target, proxy);\n\n  return proxy;\n}\n\nfunction lengthInUtf8Bytes(str) {\n  // Matches only the 10.. bytes that are non-initial characters in a multi-byte sequence.\n  var m = encodeURIComponent(str).match(/%[89ABab]/g);\n  return str.length + (m ? m.length : 0);\n}\n\nfunction urlVerification(url) {\n  var urlRecord = new urlParse(url);\n  var pathname = urlRecord.pathname;\n  var protocol = urlRecord.protocol;\n  var hash = urlRecord.hash;\n\n  if (!url) {\n    throw new TypeError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" 1 argument required, but only 0 present.\"));\n  }\n\n  if (!pathname) {\n    urlRecord.pathname = '/';\n  }\n\n  if (protocol === '') {\n    throw new SyntaxError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The URL '\" + (urlRecord.toString()) + \"' is invalid.\"));\n  }\n\n  if (protocol !== 'ws:' && protocol !== 'wss:') {\n    throw new SyntaxError(\n      ((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The URL's scheme must be either 'ws' or 'wss'. '\" + protocol + \"' is not allowed.\")\n    );\n  }\n\n  if (hash !== '') {\n    /* eslint-disable max-len */\n    throw new SyntaxError(\n      ((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The URL contains a fragment identifier ('\" + hash + \"'). Fragment identifiers are not allowed in WebSocket URLs.\")\n    );\n    /* eslint-enable max-len */\n  }\n\n  return urlRecord.toString();\n}\n\nfunction protocolVerification(protocols) {\n  if ( protocols === void 0 ) protocols = [];\n\n  if (!Array.isArray(protocols) && typeof protocols !== 'string') {\n    throw new SyntaxError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The subprotocol '\" + (protocols.toString()) + \"' is invalid.\"));\n  }\n\n  if (typeof protocols === 'string') {\n    protocols = [protocols];\n  }\n\n  var uniq = protocols\n    .map(function (p) { return ({ count: 1, protocol: p }); })\n    .reduce(function (a, b) {\n      a[b.protocol] = (a[b.protocol] || 0) + b.count;\n      return a;\n    }, {});\n\n  var duplicates = Object.keys(uniq).filter(function (a) { return uniq[a] > 1; });\n\n  if (duplicates.length > 0) {\n    throw new SyntaxError(((ERROR_PREFIX.CONSTRUCTOR_ERROR) + \" The subprotocol '\" + (duplicates[0]) + \"' is duplicated.\"));\n  }\n\n  return protocols;\n}\n\n/*\n * The main websocket class which is designed to mimick the native WebSocket class as close\n * as possible.\n *\n * https://html.spec.whatwg.org/multipage/web-sockets.html\n */\nvar WebSocket$1 = (function (EventTarget$$1) {\n  function WebSocket(url, protocols) {\n    EventTarget$$1.call(this);\n\n    this._onopen = null;\n    this._onmessage = null;\n    this._onerror = null;\n    this._onclose = null;\n\n    this.url = urlVerification(url);\n    protocols = protocolVerification(protocols);\n    this.protocol = protocols[0] || '';\n\n    this.binaryType = 'blob';\n    this.readyState = WebSocket.CONNECTING;\n\n    var client = proxyFactory(this);\n    var server = networkBridge.attachWebSocket(client, this.url);\n\n    /*\n     * This delay is needed so that we dont trigger an event before the callbacks have been\n     * setup. For example:\n     *\n     * var socket = new WebSocket('ws://localhost');\n     *\n     * If we dont have the delay then the event would be triggered right here and this is\n     * before the onopen had a chance to register itself.\n     *\n     * socket.onopen = () => { // this would never be called };\n     *\n     * and with the delay the event gets triggered here after all of the callbacks have been\n     * registered :-)\n     */\n    delay(function delayCallback() {\n      if (server) {\n        if (\n          server.options.verifyClient &&\n          typeof server.options.verifyClient === 'function' &&\n          !server.options.verifyClient()\n        ) {\n          this.readyState = WebSocket.CLOSED;\n\n          log(\n            'error',\n            (\"WebSocket connection to '\" + (this.url) + \"' failed: HTTP Authentication failed; no valid credentials available\")\n          );\n\n          networkBridge.removeWebSocket(client, this.url);\n          this.dispatchEvent(createEvent({ type: 'error', target: this }));\n          this.dispatchEvent(createCloseEvent({ type: 'close', target: this, code: CLOSE_CODES.CLOSE_NORMAL }));\n        } else {\n          if (server.options.selectProtocol && typeof server.options.selectProtocol === 'function') {\n            var selectedProtocol = server.options.selectProtocol(protocols);\n            var isFilled = selectedProtocol !== '';\n            var isRequested = protocols.indexOf(selectedProtocol) !== -1;\n            if (isFilled && !isRequested) {\n              this.readyState = WebSocket.CLOSED;\n\n              log('error', (\"WebSocket connection to '\" + (this.url) + \"' failed: Invalid Sub-Protocol\"));\n\n              networkBridge.removeWebSocket(client, this.url);\n              this.dispatchEvent(createEvent({ type: 'error', target: this }));\n              this.dispatchEvent(createCloseEvent({ type: 'close', target: this, code: CLOSE_CODES.CLOSE_NORMAL }));\n              return;\n            }\n            this.protocol = selectedProtocol;\n          }\n          this.readyState = WebSocket.OPEN;\n          this.dispatchEvent(createEvent({ type: 'open', target: this }));\n          server.dispatchEvent(createEvent({ type: 'connection' }), client);\n        }\n      } else {\n        this.readyState = WebSocket.CLOSED;\n        this.dispatchEvent(createEvent({ type: 'error', target: this }));\n        this.dispatchEvent(createCloseEvent({ type: 'close', target: this, code: CLOSE_CODES.CLOSE_NORMAL }));\n\n        log('error', (\"WebSocket connection to '\" + (this.url) + \"' failed\"));\n      }\n    }, this);\n  }\n\n  if ( EventTarget$$1 ) WebSocket.__proto__ = EventTarget$$1;\n  WebSocket.prototype = Object.create( EventTarget$$1 && EventTarget$$1.prototype );\n  WebSocket.prototype.constructor = WebSocket;\n\n  var prototypeAccessors = { onopen: {},onmessage: {},onclose: {},onerror: {} };\n\n  prototypeAccessors.onopen.get = function () {\n    return this._onopen;\n  };\n\n  prototypeAccessors.onmessage.get = function () {\n    return this._onmessage;\n  };\n\n  prototypeAccessors.onclose.get = function () {\n    return this._onclose;\n  };\n\n  prototypeAccessors.onerror.get = function () {\n    return this._onerror;\n  };\n\n  prototypeAccessors.onopen.set = function (listener) {\n    this.removeEventListener('open', this._onopen);\n    this._onopen = listener;\n    this.addEventListener('open', listener);\n  };\n\n  prototypeAccessors.onmessage.set = function (listener) {\n    this.removeEventListener('message', this._onmessage);\n    this._onmessage = listener;\n    this.addEventListener('message', listener);\n  };\n\n  prototypeAccessors.onclose.set = function (listener) {\n    this.removeEventListener('close', this._onclose);\n    this._onclose = listener;\n    this.addEventListener('close', listener);\n  };\n\n  prototypeAccessors.onerror.set = function (listener) {\n    this.removeEventListener('error', this._onerror);\n    this._onerror = listener;\n    this.addEventListener('error', listener);\n  };\n\n  WebSocket.prototype.send = function send (data) {\n    var this$1 = this;\n\n    if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n      throw new Error('WebSocket is already in CLOSING or CLOSED state');\n    }\n\n    // TODO: handle bufferedAmount\n\n    var messageEvent = createMessageEvent({\n      type: 'server::message',\n      origin: this.url,\n      data: normalizeSendData(data)\n    });\n\n    var server = networkBridge.serverLookup(this.url);\n\n    if (server) {\n      delay(function () {\n        this$1.dispatchEvent(messageEvent, data);\n      }, server);\n    }\n  };\n\n  WebSocket.prototype.close = function close (code, reason) {\n    if (code !== undefined) {\n      if (typeof code !== 'number' || (code !== 1000 && (code < 3000 || code > 4999))) {\n        throw new TypeError(\n          ((ERROR_PREFIX.CLOSE_ERROR) + \" The code must be either 1000, or between 3000 and 4999. \" + code + \" is neither.\")\n        );\n      }\n    }\n\n    if (reason !== undefined) {\n      var length = lengthInUtf8Bytes(reason);\n\n      if (length > 123) {\n        throw new SyntaxError(((ERROR_PREFIX.CLOSE_ERROR) + \" The message must not be greater than 123 bytes.\"));\n      }\n    }\n\n    if (this.readyState === WebSocket.CLOSING || this.readyState === WebSocket.CLOSED) {\n      return;\n    }\n\n    var client = proxyFactory(this);\n    if (this.readyState === WebSocket.CONNECTING) {\n      failWebSocketConnection(client, code || CLOSE_CODES.CLOSE_ABNORMAL, reason);\n    } else {\n      closeWebSocketConnection(client, code || CLOSE_CODES.CLOSE_NO_STATUS, reason);\n    }\n  };\n\n  Object.defineProperties( WebSocket.prototype, prototypeAccessors );\n\n  return WebSocket;\n}(EventTarget));\n\nWebSocket$1.CONNECTING = 0;\nWebSocket$1.prototype.CONNECTING = WebSocket$1.CONNECTING;\nWebSocket$1.OPEN = 1;\nWebSocket$1.prototype.OPEN = WebSocket$1.OPEN;\nWebSocket$1.CLOSING = 2;\nWebSocket$1.prototype.CLOSING = WebSocket$1.CLOSING;\nWebSocket$1.CLOSED = 3;\nWebSocket$1.prototype.CLOSED = WebSocket$1.CLOSED;\n\n/*\n * The socket-io class is designed to mimick the real API as closely as possible.\n *\n * http://socket.io/docs/\n */\nvar SocketIO$1 = (function (EventTarget$$1) {\n  function SocketIO(url, protocol) {\n    var this$1 = this;\n    if ( url === void 0 ) url = 'socket.io';\n    if ( protocol === void 0 ) protocol = '';\n\n    EventTarget$$1.call(this);\n\n    this.binaryType = 'blob';\n    var urlRecord = new urlParse(url);\n\n    if (!urlRecord.pathname) {\n      urlRecord.pathname = '/';\n    }\n\n    this.url = urlRecord.toString();\n    this.readyState = SocketIO.CONNECTING;\n    this.protocol = '';\n    this.target = this;\n\n    if (typeof protocol === 'string' || (typeof protocol === 'object' && protocol !== null)) {\n      this.protocol = protocol;\n    } else if (Array.isArray(protocol) && protocol.length > 0) {\n      this.protocol = protocol[0];\n    }\n\n    var server = networkBridge.attachWebSocket(this, this.url);\n\n    /*\n     * Delay triggering the connection events so they can be defined in time.\n     */\n    delay(function delayCallback() {\n      if (server) {\n        this.readyState = SocketIO.OPEN;\n        server.dispatchEvent(createEvent({ type: 'connection' }), server, this);\n        server.dispatchEvent(createEvent({ type: 'connect' }), server, this); // alias\n        this.dispatchEvent(createEvent({ type: 'connect', target: this }));\n      } else {\n        this.readyState = SocketIO.CLOSED;\n        this.dispatchEvent(createEvent({ type: 'error', target: this }));\n        this.dispatchEvent(\n          createCloseEvent({\n            type: 'close',\n            target: this,\n            code: CLOSE_CODES.CLOSE_NORMAL\n          })\n        );\n\n        log('error', (\"Socket.io connection to '\" + (this.url) + \"' failed\"));\n      }\n    }, this);\n\n    /**\n      Add an aliased event listener for close / disconnect\n     */\n    this.addEventListener('close', function (event) {\n      this$1.dispatchEvent(\n        createCloseEvent({\n          type: 'disconnect',\n          target: event.target,\n          code: event.code\n        })\n      );\n    });\n  }\n\n  if ( EventTarget$$1 ) SocketIO.__proto__ = EventTarget$$1;\n  SocketIO.prototype = Object.create( EventTarget$$1 && EventTarget$$1.prototype );\n  SocketIO.prototype.constructor = SocketIO;\n\n  var prototypeAccessors = { broadcast: {} };\n\n  /*\n   * Closes the SocketIO connection or connection attempt, if any.\n   * If the connection is already CLOSED, this method does nothing.\n   */\n  SocketIO.prototype.close = function close () {\n    if (this.readyState !== SocketIO.OPEN) {\n      return undefined;\n    }\n\n    var server = networkBridge.serverLookup(this.url);\n    networkBridge.removeWebSocket(this, this.url);\n\n    this.readyState = SocketIO.CLOSED;\n    this.dispatchEvent(\n      createCloseEvent({\n        type: 'close',\n        target: this,\n        code: CLOSE_CODES.CLOSE_NORMAL\n      })\n    );\n\n    if (server) {\n      server.dispatchEvent(\n        createCloseEvent({\n          type: 'disconnect',\n          target: this,\n          code: CLOSE_CODES.CLOSE_NORMAL\n        }),\n        server\n      );\n    }\n\n    return this;\n  };\n\n  /*\n   * Alias for Socket#close\n   *\n   * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L383\n   */\n  SocketIO.prototype.disconnect = function disconnect () {\n    return this.close();\n  };\n\n  /*\n   * Submits an event to the server with a payload\n   */\n  SocketIO.prototype.emit = function emit (event) {\n    var data = [], len = arguments.length - 1;\n    while ( len-- > 0 ) data[ len ] = arguments[ len + 1 ];\n\n    if (this.readyState !== SocketIO.OPEN) {\n      throw new Error('SocketIO is already in CLOSING or CLOSED state');\n    }\n\n    var messageEvent = createMessageEvent({\n      type: event,\n      origin: this.url,\n      data: data\n    });\n\n    var server = networkBridge.serverLookup(this.url);\n\n    if (server) {\n      server.dispatchEvent.apply(server, [ messageEvent ].concat( data ));\n    }\n\n    return this;\n  };\n\n  /*\n   * Submits a 'message' event to the server.\n   *\n   * Should behave exactly like WebSocket#send\n   *\n   * https://github.com/socketio/socket.io-client/blob/master/lib/socket.js#L113\n   */\n  SocketIO.prototype.send = function send (data) {\n    this.emit('message', data);\n    return this;\n  };\n\n  /*\n   * For broadcasting events to other connected sockets.\n   *\n   * e.g. socket.broadcast.emit('hi!');\n   * e.g. socket.broadcast.to('my-room').emit('hi!');\n   */\n  prototypeAccessors.broadcast.get = function () {\n    if (this.readyState !== SocketIO.OPEN) {\n      throw new Error('SocketIO is already in CLOSING or CLOSED state');\n    }\n\n    var self = this;\n    var server = networkBridge.serverLookup(this.url);\n    if (!server) {\n      throw new Error((\"SocketIO can not find a server at the specified URL (\" + (this.url) + \")\"));\n    }\n\n    return {\n      emit: function emit(event, data) {\n        server.emit(event, data, { websockets: networkBridge.websocketsLookup(self.url, null, self) });\n        return self;\n      },\n      to: function to(room) {\n        return server.to(room, self);\n      },\n      in: function in$1(room) {\n        return server.in(room, self);\n      }\n    };\n  };\n\n  /*\n   * For registering events to be received from the server\n   */\n  SocketIO.prototype.on = function on (type, callback) {\n    this.addEventListener(type, callback);\n    return this;\n  };\n\n  /*\n   * Remove event listener\n   *\n   * https://github.com/component/emitter#emitteroffevent-fn\n   */\n  SocketIO.prototype.off = function off (type, callback) {\n    this.removeEventListener(type, callback);\n  };\n\n  /*\n   * Check if listeners have already been added for an event\n   *\n   * https://github.com/component/emitter#emitterhaslistenersevent\n   */\n  SocketIO.prototype.hasListeners = function hasListeners (type) {\n    var listeners = this.listeners[type];\n    if (!Array.isArray(listeners)) {\n      return false;\n    }\n    return !!listeners.length;\n  };\n\n  /*\n   * Join a room on a server\n   *\n   * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n   */\n  SocketIO.prototype.join = function join (room) {\n    networkBridge.addMembershipToRoom(this, room);\n  };\n\n  /*\n   * Get the websocket to leave the room\n   *\n   * http://socket.io/docs/rooms-and-namespaces/#joining-and-leaving\n   */\n  SocketIO.prototype.leave = function leave (room) {\n    networkBridge.removeMembershipFromRoom(this, room);\n  };\n\n  SocketIO.prototype.to = function to (room) {\n    return this.broadcast.to(room);\n  };\n\n  SocketIO.prototype.in = function in$1 () {\n    return this.to.apply(null, arguments);\n  };\n\n  /*\n   * Invokes all listener functions that are listening to the given event.type property. Each\n   * listener will be passed the event as the first argument.\n   *\n   * @param {object} event - event object which will be passed to all listeners of the event.type property\n   */\n  SocketIO.prototype.dispatchEvent = function dispatchEvent (event) {\n    var this$1 = this;\n    var customArguments = [], len = arguments.length - 1;\n    while ( len-- > 0 ) customArguments[ len ] = arguments[ len + 1 ];\n\n    var eventName = event.type;\n    var listeners = this.listeners[eventName];\n\n    if (!Array.isArray(listeners)) {\n      return false;\n    }\n\n    listeners.forEach(function (listener) {\n      if (customArguments.length > 0) {\n        listener.apply(this$1, customArguments);\n      } else {\n        // Regular WebSockets expect a MessageEvent but Socketio.io just wants raw data\n        //  payload instanceof MessageEvent works, but you can't isntance of NodeEvent\n        //  for now we detect if the output has data defined on it\n        listener.call(this$1, event.data ? event.data : event);\n      }\n    });\n  };\n\n  Object.defineProperties( SocketIO.prototype, prototypeAccessors );\n\n  return SocketIO;\n}(EventTarget));\n\nSocketIO$1.CONNECTING = 0;\nSocketIO$1.OPEN = 1;\nSocketIO$1.CLOSING = 2;\nSocketIO$1.CLOSED = 3;\n\n/*\n * Static constructor methods for the IO Socket\n */\nvar IO = function ioConstructor(url, protocol) {\n  return new SocketIO$1(url, protocol);\n};\n\n/*\n * Alias the raw IO() constructor\n */\nIO.connect = function ioConnect(url, protocol) {\n  /* eslint-disable new-cap */\n  return IO(url, protocol);\n  /* eslint-enable new-cap */\n};\n\nvar dedupe = function (arr) { return arr.reduce(function (deduped, b) {\n    if (deduped.indexOf(b) > -1) { return deduped; }\n    return deduped.concat(b);\n  }, []); };\n\nfunction retrieveGlobalObject() {\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n\n  return typeof process === 'object' && typeof require === 'function' && typeof global === 'object' ? global : this;\n}\n\nvar defaultOptions = {\n  mock: true,\n  verifyClient: null,\n  selectProtocol: null\n};\n\nvar Server$1 = (function (EventTarget$$1) {\n  function Server(url, options) {\n    if ( options === void 0 ) options = defaultOptions;\n\n    EventTarget$$1.call(this);\n    var urlRecord = new urlParse(url);\n\n    if (!urlRecord.pathname) {\n      urlRecord.pathname = '/';\n    }\n\n    this.url = urlRecord.toString();\n\n    this.originalWebSocket = null;\n    var server = networkBridge.attachServer(this, this.url);\n\n    if (!server) {\n      this.dispatchEvent(createEvent({ type: 'error' }));\n      throw new Error('A mock server is already listening on this url');\n    }\n\n    this.options = Object.assign({}, defaultOptions, options);\n\n    if (this.options.mock) {\n      this.mockWebsocket();\n    }\n  }\n\n  if ( EventTarget$$1 ) Server.__proto__ = EventTarget$$1;\n  Server.prototype = Object.create( EventTarget$$1 && EventTarget$$1.prototype );\n  Server.prototype.constructor = Server;\n\n  /*\n   * Attaches the mock websocket object to the global object\n   */\n  Server.prototype.mockWebsocket = function mockWebsocket () {\n    var globalObj = retrieveGlobalObject();\n\n    this.originalWebSocket = globalObj.WebSocket;\n    globalObj.WebSocket = WebSocket$1;\n  };\n\n  /*\n   * Removes the mock websocket object from the global object\n   */\n  Server.prototype.restoreWebsocket = function restoreWebsocket () {\n    var globalObj = retrieveGlobalObject();\n\n    if (this.originalWebSocket !== null) {\n      globalObj.WebSocket = this.originalWebSocket;\n    }\n\n    this.originalWebSocket = null;\n  };\n\n  /**\n   * Removes itself from the urlMap so another server could add itself to the url.\n   * @param {function} callback - The callback is called when the server is stopped\n   */\n  Server.prototype.stop = function stop (callback) {\n    if ( callback === void 0 ) callback = function () {};\n\n    if (this.options.mock) {\n      this.restoreWebsocket();\n    }\n\n    networkBridge.removeServer(this.url);\n\n    if (typeof callback === 'function') {\n      callback();\n    }\n  };\n\n  /*\n   * This is the main function for the mock server to subscribe to the on events.\n   *\n   * ie: mockServer.on('connection', function() { console.log('a mock client connected'); });\n   *\n   * @param {string} type - The event key to subscribe to. Valid keys are: connection, message, and close.\n   * @param {function} callback - The callback which should be called when a certain event is fired.\n   */\n  Server.prototype.on = function on (type, callback) {\n    this.addEventListener(type, callback);\n  };\n\n  /*\n   * Remove event listener\n   */\n  Server.prototype.off = function off (type, callback) {\n    this.removeEventListener(type, callback);\n  };\n\n  /*\n   * Closes the connection and triggers the onclose method of all listening\n   * websockets. After that it removes itself from the urlMap so another server\n   * could add itself to the url.\n   *\n   * @param {object} options\n   */\n  Server.prototype.close = function close (options) {\n    if ( options === void 0 ) options = {};\n\n    var code = options.code;\n    var reason = options.reason;\n    var wasClean = options.wasClean;\n    var listeners = networkBridge.websocketsLookup(this.url);\n\n    // Remove server before notifications to prevent immediate reconnects from\n    // socket onclose handlers\n    networkBridge.removeServer(this.url);\n\n    listeners.forEach(function (socket) {\n      socket.readyState = WebSocket$1.CLOSED;\n      socket.dispatchEvent(\n        createCloseEvent({\n          type: 'close',\n          target: socket.target,\n          code: code || CLOSE_CODES.CLOSE_NORMAL,\n          reason: reason || '',\n          wasClean: wasClean\n        })\n      );\n    });\n\n    this.dispatchEvent(createCloseEvent({ type: 'close' }), this);\n  };\n\n  /*\n   * Sends a generic message event to all mock clients.\n   */\n  Server.prototype.emit = function emit (event, data, options) {\n    var this$1 = this;\n    if ( options === void 0 ) options = {};\n\n    var websockets = options.websockets;\n\n    if (!websockets) {\n      websockets = networkBridge.websocketsLookup(this.url);\n    }\n\n    var normalizedData;\n    if (typeof options !== 'object' || arguments.length > 3) {\n      data = Array.prototype.slice.call(arguments, 1, arguments.length);\n      normalizedData = data.map(function (item) { return normalizeSendData(item); });\n    } else {\n      normalizedData = normalizeSendData(data);\n    }\n\n    websockets.forEach(function (socket) {\n      var messageData = socket instanceof SocketIO$1 ? data : normalizedData;\n      if (Array.isArray(messageData)) {\n        socket.dispatchEvent.apply(\n          socket, [ createMessageEvent({\n            type: event,\n            data: messageData,\n            origin: this$1.url,\n            target: socket.target\n          }) ].concat( messageData )\n        );\n      } else {\n        socket.dispatchEvent(\n          createMessageEvent({\n            type: event,\n            data: messageData,\n            origin: this$1.url,\n            target: socket.target\n          })\n        );\n      }\n    });\n  };\n\n  /*\n   * Returns an array of websockets which are listening to this server\n   * TOOD: this should return a set and not be a method\n   */\n  Server.prototype.clients = function clients () {\n    return networkBridge.websocketsLookup(this.url);\n  };\n\n  /*\n   * Prepares a method to submit an event to members of the room\n   *\n   * e.g. server.to('my-room').emit('hi!');\n   */\n  Server.prototype.to = function to (room, broadcaster, broadcastList) {\n    var this$1 = this;\n    if ( broadcastList === void 0 ) broadcastList = [];\n\n    var self = this;\n    var websockets = dedupe(broadcastList.concat(networkBridge.websocketsLookup(this.url, room, broadcaster)));\n\n    return {\n      to: function (chainedRoom, chainedBroadcaster) { return this$1.to.call(this$1, chainedRoom, chainedBroadcaster, websockets); },\n      emit: function emit(event, data) {\n        self.emit(event, data, { websockets: websockets });\n      }\n    };\n  };\n\n  /*\n   * Alias for Server.to\n   */\n  Server.prototype.in = function in$1 () {\n    var args = [], len = arguments.length;\n    while ( len-- ) args[ len ] = arguments[ len ];\n\n    return this.to.apply(null, args);\n  };\n\n  /*\n   * Simulate an event from the server to the clients. Useful for\n   * simulating errors.\n   */\n  Server.prototype.simulate = function simulate (event) {\n    var listeners = networkBridge.websocketsLookup(this.url);\n\n    if (event === 'error') {\n      listeners.forEach(function (socket) {\n        socket.readyState = WebSocket$1.CLOSED;\n        socket.dispatchEvent(createEvent({ type: 'error', target: socket.target }));\n      });\n    }\n  };\n\n  return Server;\n}(EventTarget));\n\n/*\n * Alternative constructor to support namespaces in socket.io\n *\n * http://socket.io/docs/rooms-and-namespaces/#custom-namespaces\n */\nServer$1.of = function of(url) {\n  return new Server$1(url);\n};\n\nvar Server = Server$1;\nvar WebSocket = WebSocket$1;\nvar SocketIO$$1 = IO;\n\nexports.Server = Server;\nexports.WebSocket = WebSocket;\nexports.SocketIO = SocketIO$$1;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}