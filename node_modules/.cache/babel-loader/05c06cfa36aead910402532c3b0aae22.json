{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nexports.__esModule = true;\nexports.Database = exports.SERIALIZED_INTERNAL_PROPERTIES_KEY = void 0;\nvar md5_1 = __importDefault(require(\"md5\"));\nvar outvariant_1 = require(\"outvariant\");\nvar strict_event_emitter_1 = require(\"strict-event-emitter\");\nvar glossary_1 = require(\"../glossary\");\nexports.SERIALIZED_INTERNAL_PROPERTIES_KEY = 'SERIALIZED_INTERNAL_PROPERTIES';\nvar callOrder = 0;\nvar Database = /** @class */function () {\n  function Database(dictionary) {\n    this.events = new strict_event_emitter_1.StrictEventEmitter();\n    this.models = Object.keys(dictionary).reduce(function (acc, modelName) {\n      acc[modelName] = new Map();\n      return acc;\n    }, {});\n    callOrder++;\n    this.id = this.generateId();\n  }\n  /**\n   * Generates a unique MD5 hash based on the database\n   * module location and invocation order. Used to reproducibly\n   * identify a database instance among sibling instances.\n   */\n  Database.prototype.generateId = function () {\n    var stack = new Error().stack;\n    var callFrame = stack === null || stack === void 0 ? void 0 : stack.split('\\n')[4];\n    var salt = callOrder + \"-\" + (callFrame === null || callFrame === void 0 ? void 0 : callFrame.trim());\n    return md5_1[\"default\"](salt);\n  };\n  Database.prototype.serializeEntity = function (entity) {\n    var _a;\n    return __assign(__assign({}, entity), (_a = {}, _a[exports.SERIALIZED_INTERNAL_PROPERTIES_KEY] = {\n      entityType: entity[glossary_1.ENTITY_TYPE],\n      primaryKey: entity[glossary_1.PRIMARY_KEY]\n    }, _a));\n  };\n  Database.prototype.getModel = function (name) {\n    return this.models[name];\n  };\n  Database.prototype.create = function (modelName, entity, customPrimaryKey) {\n    outvariant_1.invariant(entity[glossary_1.ENTITY_TYPE], 'Failed to create a new \"%s\" record: provided entity has no type. %j', modelName, entity);\n    outvariant_1.invariant(entity[glossary_1.PRIMARY_KEY], 'Failed to create a new \"%s\" record: provided entity has no primary key. %j', modelName, entity);\n    var primaryKey = customPrimaryKey || entity[entity[glossary_1.PRIMARY_KEY]];\n    this.events.emit('create', this.id, [modelName, this.serializeEntity(entity), customPrimaryKey]);\n    return this.getModel(modelName).set(primaryKey, entity);\n  };\n  Database.prototype.update = function (modelName, prevEntity, nextEntity) {\n    var prevPrimaryKey = prevEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n    var nextPrimaryKey = nextEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n    if (nextPrimaryKey !== prevPrimaryKey) {\n      this[\"delete\"](modelName, prevPrimaryKey);\n    }\n    this.getModel(modelName).set(nextPrimaryKey, nextEntity);\n    // this.create(modelName, nextEntity, nextPrimaryKey)\n    this.events.emit('update', this.id, [modelName, this.serializeEntity(prevEntity), this.serializeEntity(nextEntity)]);\n  };\n  Database.prototype[\"delete\"] = function (modelName, primaryKey) {\n    this.getModel(modelName)[\"delete\"](primaryKey);\n    this.events.emit('delete', this.id, [modelName, primaryKey]);\n  };\n  Database.prototype.has = function (modelName, primaryKey) {\n    return this.getModel(modelName).has(primaryKey);\n  };\n  Database.prototype.count = function (modelName) {\n    return this.getModel(modelName).size;\n  };\n  Database.prototype.listEntities = function (modelName) {\n    return Array.from(this.getModel(modelName).values());\n  };\n  return Database;\n}();\nexports.Database = Database;","map":{"version":3,"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__importDefault","mod","__esModule","exports","Database","SERIALIZED_INTERNAL_PROPERTIES_KEY","md5_1","require","outvariant_1","strict_event_emitter_1","glossary_1","callOrder","dictionary","events","StrictEventEmitter","models","keys","reduce","acc","modelName","Map","id","generateId","stack","Error","callFrame","split","salt","trim","serializeEntity","entity","_a","entityType","ENTITY_TYPE","primaryKey","PRIMARY_KEY","getModel","name","create","customPrimaryKey","invariant","emit","set","update","prevEntity","nextEntity","prevPrimaryKey","nextPrimaryKey","has","count","size","listEntities","Array","from","values"],"sources":["/home/saif/Documents/Proxym/redux-essentials-example-app/node_modules/@mswjs/data/lib/db/Database.js"],"sourcesContent":["\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nexports.__esModule = true;\nexports.Database = exports.SERIALIZED_INTERNAL_PROPERTIES_KEY = void 0;\nvar md5_1 = __importDefault(require(\"md5\"));\nvar outvariant_1 = require(\"outvariant\");\nvar strict_event_emitter_1 = require(\"strict-event-emitter\");\nvar glossary_1 = require(\"../glossary\");\nexports.SERIALIZED_INTERNAL_PROPERTIES_KEY = 'SERIALIZED_INTERNAL_PROPERTIES';\nvar callOrder = 0;\nvar Database = /** @class */ (function () {\n    function Database(dictionary) {\n        this.events = new strict_event_emitter_1.StrictEventEmitter();\n        this.models = Object.keys(dictionary).reduce(function (acc, modelName) {\n            acc[modelName] = new Map();\n            return acc;\n        }, {});\n        callOrder++;\n        this.id = this.generateId();\n    }\n    /**\n     * Generates a unique MD5 hash based on the database\n     * module location and invocation order. Used to reproducibly\n     * identify a database instance among sibling instances.\n     */\n    Database.prototype.generateId = function () {\n        var stack = new Error().stack;\n        var callFrame = stack === null || stack === void 0 ? void 0 : stack.split('\\n')[4];\n        var salt = callOrder + \"-\" + (callFrame === null || callFrame === void 0 ? void 0 : callFrame.trim());\n        return md5_1[\"default\"](salt);\n    };\n    Database.prototype.serializeEntity = function (entity) {\n        var _a;\n        return __assign(__assign({}, entity), (_a = {}, _a[exports.SERIALIZED_INTERNAL_PROPERTIES_KEY] = {\n            entityType: entity[glossary_1.ENTITY_TYPE],\n            primaryKey: entity[glossary_1.PRIMARY_KEY]\n        }, _a));\n    };\n    Database.prototype.getModel = function (name) {\n        return this.models[name];\n    };\n    Database.prototype.create = function (modelName, entity, customPrimaryKey) {\n        outvariant_1.invariant(entity[glossary_1.ENTITY_TYPE], 'Failed to create a new \"%s\" record: provided entity has no type. %j', modelName, entity);\n        outvariant_1.invariant(entity[glossary_1.PRIMARY_KEY], 'Failed to create a new \"%s\" record: provided entity has no primary key. %j', modelName, entity);\n        var primaryKey = customPrimaryKey || entity[entity[glossary_1.PRIMARY_KEY]];\n        this.events.emit('create', this.id, [\n            modelName,\n            this.serializeEntity(entity),\n            customPrimaryKey,\n        ]);\n        return this.getModel(modelName).set(primaryKey, entity);\n    };\n    Database.prototype.update = function (modelName, prevEntity, nextEntity) {\n        var prevPrimaryKey = prevEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n        var nextPrimaryKey = nextEntity[prevEntity[glossary_1.PRIMARY_KEY]];\n        if (nextPrimaryKey !== prevPrimaryKey) {\n            this[\"delete\"](modelName, prevPrimaryKey);\n        }\n        this.getModel(modelName).set(nextPrimaryKey, nextEntity);\n        // this.create(modelName, nextEntity, nextPrimaryKey)\n        this.events.emit('update', this.id, [\n            modelName,\n            this.serializeEntity(prevEntity),\n            this.serializeEntity(nextEntity),\n        ]);\n    };\n    Database.prototype[\"delete\"] = function (modelName, primaryKey) {\n        this.getModel(modelName)[\"delete\"](primaryKey);\n        this.events.emit('delete', this.id, [modelName, primaryKey]);\n    };\n    Database.prototype.has = function (modelName, primaryKey) {\n        return this.getModel(modelName).has(primaryKey);\n    };\n    Database.prototype.count = function (modelName) {\n        return this.getModel(modelName).size;\n    };\n    Database.prototype.listEntities = function (modelName) {\n        return Array.from(this.getModel(modelName).values());\n    };\n    return Database;\n}());\nexports.Database = Database;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}