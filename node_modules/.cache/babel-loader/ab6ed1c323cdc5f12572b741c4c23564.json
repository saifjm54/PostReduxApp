{"ast":null,"code":"\"use strict\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from) {\n  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];\n  return to;\n};\nexports.__esModule = true;\nexports.sync = void 0;\nvar glossary_1 = require(\"../glossary\");\nvar Database_1 = require(\"../db/Database\");\nvar inheritInternalProperties_1 = require(\"../utils/inheritInternalProperties\");\nfunction removeListeners(event, db) {\n  var listeners = db.events.listeners(event);\n  listeners.forEach(function (listener) {\n    db.events.removeListener(event, listener);\n  });\n  return function () {\n    listeners.forEach(function (listener) {\n      db.events.addListener(event, listener);\n    });\n  };\n}\n/**\n * Sets the serialized internal properties as symbols\n * on the given entity.\n * @note `Symbol` properties are stripped off when sending\n * an object over an event emitter.\n */\nfunction deserializeEntity(entity) {\n  var _a;\n  var _b = entity,\n    _c = Database_1.SERIALIZED_INTERNAL_PROPERTIES_KEY,\n    internalProperties = _b[_c],\n    publicProperties = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n  inheritInternalProperties_1.inheritInternalProperties(publicProperties, (_a = {}, _a[glossary_1.ENTITY_TYPE] = internalProperties.entityType, _a[glossary_1.PRIMARY_KEY] = internalProperties.primaryKey, _a));\n  return publicProperties;\n}\n/**\n * Synchronizes database operations across multiple clients.\n */\nfunction sync(db) {\n  var IS_BROWSER = typeof window !== 'undefined';\n  var SUPPORTS_BROADCAST_CHANNEL = typeof BroadcastChannel !== 'undefined';\n  if (!IS_BROWSER || !SUPPORTS_BROADCAST_CHANNEL) {\n    return;\n  }\n  var channel = new BroadcastChannel('mswjs/data/sync');\n  channel.addEventListener('message', function (event) {\n    var _a = __read(event.data.payload, 1),\n      sourceId = _a[0];\n    // Ignore messages originating from unrelated databases.\n    // Useful in case of multiple databases on the same page.\n    if (db.id !== sourceId) {\n      return;\n    }\n    // Remove database event listener for the signaled operation\n    // to prevent an infinite loop when applying this operation.\n    var restoreListeners = removeListeners(event.data.operationType, db);\n    // Apply the database operation signaled from another client\n    // to the current database instance.\n    switch (event.data.operationType) {\n      case 'create':\n        {\n          var _b = __read(event.data.payload[1], 3),\n            modelName = _b[0],\n            entity = _b[1],\n            customPrimaryKey = _b[2];\n          db.create(modelName, deserializeEntity(entity), customPrimaryKey);\n          break;\n        }\n      case 'update':\n        {\n          var _c = __read(event.data.payload[1], 3),\n            modelName = _c[0],\n            prevEntity = _c[1],\n            nextEntity = _c[2];\n          db.update(modelName, deserializeEntity(prevEntity), deserializeEntity(nextEntity));\n          break;\n        }\n      default:\n        {\n          db[event.data.operationType].apply(db, __spreadArray([], __read(event.data.payload[1])));\n        }\n    }\n    // Re-attach database event listeners.\n    restoreListeners();\n  });\n  // Broadcast the emitted event from this client\n  // to all the other connected clients.\n  function broadcastDatabaseEvent(operationType) {\n    return function () {\n      var payload = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        payload[_i] = arguments[_i];\n      }\n      channel.postMessage({\n        operationType: operationType,\n        payload: payload\n      });\n    };\n  }\n  db.events.on('create', broadcastDatabaseEvent('create'));\n  db.events.on('update', broadcastDatabaseEvent('update'));\n  db.events.on('delete', broadcastDatabaseEvent('delete'));\n}\nexports.sync = sync;","map":{"version":3,"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","__read","o","n","m","Symbol","iterator","r","ar","next","done","push","value","error","__spreadArray","to","from","il","j","exports","__esModule","sync","glossary_1","require","Database_1","inheritInternalProperties_1","removeListeners","event","db","listeners","events","forEach","listener","removeListener","addListener","deserializeEntity","entity","_a","_b","_c","SERIALIZED_INTERNAL_PROPERTIES_KEY","internalProperties","publicProperties","inheritInternalProperties","ENTITY_TYPE","entityType","PRIMARY_KEY","primaryKey","IS_BROWSER","window","SUPPORTS_BROADCAST_CHANNEL","BroadcastChannel","channel","addEventListener","data","payload","sourceId","id","restoreListeners","operationType","modelName","customPrimaryKey","create","prevEntity","nextEntity","update","apply","broadcastDatabaseEvent","_i","arguments","postMessage","on"],"sources":["/home/saif/Documents/Proxym/redux-essentials-example-app/node_modules/@mswjs/data/lib/extensions/sync.js"],"sourcesContent":["\"use strict\";\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from) {\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\n        to[j] = from[i];\n    return to;\n};\nexports.__esModule = true;\nexports.sync = void 0;\nvar glossary_1 = require(\"../glossary\");\nvar Database_1 = require(\"../db/Database\");\nvar inheritInternalProperties_1 = require(\"../utils/inheritInternalProperties\");\nfunction removeListeners(event, db) {\n    var listeners = db.events.listeners(event);\n    listeners.forEach(function (listener) {\n        db.events.removeListener(event, listener);\n    });\n    return function () {\n        listeners.forEach(function (listener) {\n            db.events.addListener(event, listener);\n        });\n    };\n}\n/**\n * Sets the serialized internal properties as symbols\n * on the given entity.\n * @note `Symbol` properties are stripped off when sending\n * an object over an event emitter.\n */\nfunction deserializeEntity(entity) {\n    var _a;\n    var _b = entity, _c = Database_1.SERIALIZED_INTERNAL_PROPERTIES_KEY, internalProperties = _b[_c], publicProperties = __rest(_b, [typeof _c === \"symbol\" ? _c : _c + \"\"]);\n    inheritInternalProperties_1.inheritInternalProperties(publicProperties, (_a = {},\n        _a[glossary_1.ENTITY_TYPE] = internalProperties.entityType,\n        _a[glossary_1.PRIMARY_KEY] = internalProperties.primaryKey,\n        _a));\n    return publicProperties;\n}\n/**\n * Synchronizes database operations across multiple clients.\n */\nfunction sync(db) {\n    var IS_BROWSER = typeof window !== 'undefined';\n    var SUPPORTS_BROADCAST_CHANNEL = typeof BroadcastChannel !== 'undefined';\n    if (!IS_BROWSER || !SUPPORTS_BROADCAST_CHANNEL) {\n        return;\n    }\n    var channel = new BroadcastChannel('mswjs/data/sync');\n    channel.addEventListener('message', function (event) {\n        var _a = __read(event.data.payload, 1), sourceId = _a[0];\n        // Ignore messages originating from unrelated databases.\n        // Useful in case of multiple databases on the same page.\n        if (db.id !== sourceId) {\n            return;\n        }\n        // Remove database event listener for the signaled operation\n        // to prevent an infinite loop when applying this operation.\n        var restoreListeners = removeListeners(event.data.operationType, db);\n        // Apply the database operation signaled from another client\n        // to the current database instance.\n        switch (event.data.operationType) {\n            case 'create': {\n                var _b = __read(event.data.payload[1], 3), modelName = _b[0], entity = _b[1], customPrimaryKey = _b[2];\n                db.create(modelName, deserializeEntity(entity), customPrimaryKey);\n                break;\n            }\n            case 'update': {\n                var _c = __read(event.data.payload[1], 3), modelName = _c[0], prevEntity = _c[1], nextEntity = _c[2];\n                db.update(modelName, deserializeEntity(prevEntity), deserializeEntity(nextEntity));\n                break;\n            }\n            default: {\n                db[event.data.operationType].apply(db, __spreadArray([], __read(event.data.payload[1])));\n            }\n        }\n        // Re-attach database event listeners.\n        restoreListeners();\n    });\n    // Broadcast the emitted event from this client\n    // to all the other connected clients.\n    function broadcastDatabaseEvent(operationType) {\n        return function () {\n            var payload = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                payload[_i] = arguments[_i];\n            }\n            channel.postMessage({\n                operationType: operationType,\n                payload: payload\n            });\n        };\n    }\n    db.events.on('create', broadcastDatabaseEvent('create'));\n    db.events.on('update', broadcastDatabaseEvent('update'));\n    db.events.on('delete', broadcastDatabaseEvent('delete'));\n}\nexports.sync = sync;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}